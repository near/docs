---
id: donation
title: Donation
description: "Build a donation smart contract that accepts NEAR tokens, tracks donations, and distributes funds to beneficiaries with transparent accounting."
---

import {CodeTabs, Language, Github} from '@site/src/components/codetabs';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import MovingForwardSupportSection from '@site/src/components/MovingForwardSupportSection';

Our donation example enables to forward NEAR Tokens to an account while keeping track of it. It is one of the simplest examples on making a contract handle transfers.

![img](/docs/assets/examples/donation.png)
_Frontend of the Donation App_

---

## Obtaining the Donation Example

You have two options to start the Donation Example.

1. You can use the app through `Github Codespaces`, which will open a web-based interactive environment.
2. Clone the repository locally and use it from your computer.

| Codespaces                                                                                                                      | Clone locally                                               |
| ------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| [![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/near-examples/donation-examples) | ğŸŒ `https://github.com/near-examples/donation-examples.git` |

---

## Structure of the Example

The example is divided in two main components:

1. The smart contract, available in two flavors: rust and javascript
2. The frontend, that interacts with an already deployed contract.

<Tabs groupId="code-tabs">

  <TabItem value="js" label="ğŸŒ JavaScript">

```bash
â”Œâ”€â”€ sandbox-ts # sandbox testing
â”‚    â”œâ”€â”€ src
â”‚    â”‚    â””â”€â”€ main.ava.ts
â”‚    â”œâ”€â”€ ava.config.cjs
â”‚    â””â”€â”€ package.json
â”œâ”€â”€ src # contract's code
â”‚    â”œâ”€â”€ contract.ts
â”‚    â”œâ”€â”€ model.ts
â”‚    â””â”€â”€ utils.ts
â”œâ”€â”€ package.json # package manager
â”œâ”€â”€ README.md
â””â”€â”€ tsconfig.json # test script
```

  </TabItem>

  <TabItem value="rust" label="ğŸ¦€ Rust">

```bash
â”Œâ”€â”€ tests # workspaces testing
â”‚    â”œâ”€â”€ workspaces.rs
â”œâ”€â”€ src # contract's code
â”‚    â”œâ”€â”€ donation.rs
â”‚    â””â”€â”€ lib.rs
â”œâ”€â”€ Cargo.toml # package manager
â”œâ”€â”€ README.md
â””â”€â”€ rust-toolchain.toml
```

  </TabItem>

</Tabs>

---

## Frontend

The donation example includes a frontend that interacts with an already deployed smart contract, allowing user to donate NEAR tokens to a faucet service.

<hr class="subsection" />

### Running the Frontend

To start the frontend you will need to install the dependencies and start the server.

```bash
cd frontend
yarn
yarn dev
```

Go ahead and login with your NEAR account. If you don't have one, you will be able to create one in the moment. Once logged in, input the amount of NEAR you want to donate and press the donate button. You will be redirected to the NEAR Wallet to confirm the transaction. After confirming it, the donation will be listed in the "Latest Donations".

<hr class="subsection" />

### Understanding the Frontend

The frontend is a [Next.JS](https://nextjs.org/) project generated by [create-near-app](https://github.com/near/create-near-app). Check `DonationsTable.jsx` and `DonationsForm.jsx` to understand how components are displayed and interacting with the contract.

<Language value="js" language="js">
  <Github fname="DonationsTable.jsx"
          url="https://github.com/near-examples/donation-examples/blob/main/frontend/src/components/DonationsTable.jsx"/>
  <Github fname="DonationsForm.jsx"
          url="https://github.com/near-examples/donation-examples/blob/main/frontend/src/components/DonationForm.jsx"/>
</Language>

An interesting aspect of the donation example is that it showcases how to retrieve a result after being redirected to the
NEAR wallet to accept a transaction.

---

## Smart Contract

The contract exposes methods to donate tokens (`donate`), and methods to retrieve the recorded donations (e.g. `get_donation_for_account`).

<CodeTabs>
  <Language value="js" language="ts">
    <Github fname="contract.ts"
            url="https://github.com/near-examples/donation-examples/blob/main/contract-ts/src/contract.ts"
            start="16" end="44" />
  </Language>
  <Language value="rust" language="rust">
    <Github fname="lib.rs"
            url="https://github.com/near-examples/donation-examples/blob/main/contract-rs/src/donation.rs"
            start="17" end="74" />
  </Language>
</CodeTabs>

<hr class="subsection" />

### Testing the Contract

The contract readily includes a set of unit and sandbox testing to validate its functionality. To execute the tests, run the following commands:

<Tabs groupId="code-tabs">
  <TabItem value="js" label="ğŸŒ JavaScript">

  ```bash
  cd contract-ts
  yarn
  yarn test
  ```

  </TabItem>
  <TabItem value="rust" label="ğŸ¦€ Rust">
  
  ```bash
  cd contract-rs
  cargo test
  ```

  </TabItem>

</Tabs>

:::tip
The `integration tests` use a sandbox to create NEAR users and simulate interactions with the contract.
:::

<hr class="subsection" />

### Deploying the Contract to the NEAR network

In order to deploy the contract you will need to create a NEAR account.

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  # Create a new account pre-funded by a faucet
  near create-account <accountId> --useFaucet
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  # Create a new account pre-funded by a faucet
  near account create-account sponsor-by-faucet-service <my-new-dev-account>.testnet autogenerate-new-keypair save-to-keychain network-config testnet create
  ```
  </TabItem>
</Tabs>

Go into the directory containing the smart contract (`cd contract-ts` or `cd contract-rs`), build and deploy it:

<Tabs groupId="code-tabs">

  <TabItem value="js" label="ğŸŒ JavaScript">

    ```bash
    npm run build
    near deploy <accountId> ./build/donation.wasm
    ```

  </TabItem>
  <TabItem value="rust" label="ğŸ¦€ Rust">
  
  ```bash
  cargo near deploy build-non-reproducible-wasm <accountId>
  ```

  </TabItem>

</Tabs>

:::tip
To interact with your contract from the [frontend](#frontend), simply replace the variable `CONTRACT_NAME` in the `index.js` file.
:::

<hr class="subsection" />

### CLI: Interacting with the Contract

To interact with the contract through the console, you can use the following commands

#### Get donations

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  near view donation.near-examples.testnet get_donations '{"from_index": "0","limit": "10"}'
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  near contract call-function as-read-only donation.near-examples.testnet get_donations json-args '{"from_index": "0","limit": "10"}' network-config testnet now
  ```
  </TabItem>
</Tabs>

<hr class="subsection" />

#### Get beneficiary

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  near view donation.near-examples.testnet get_beneficiary
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  near contract call-function as-read-only donation.near-examples.testnet get_beneficiary json-args {} network-config testnet now
  ```
  </TabItem>
</Tabs>

<hr class="subsection" />

#### Get number of donors

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  near view donation.near-examples.testnet number_of_donors
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  near contract call-function as-read-only donation.near-examples.testnet number_of_donors json-args {} network-config testnet now
  ```
  </TabItem>
</Tabs>

<hr class="subsection" />

#### Get donation for an account

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  # Require accountId
  near view donation.near-examples.testnet get_donation_for_account '{"account_id":<accountId>}'
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  # Require accountId
  near contract call-function as-read-only donation.near-examples.testnet get_donation_for_account json-args '{"account_id":<accountId>}' network-config testnet now
  ```
  </TabItem>
</Tabs>

<hr class="subsection" />

#### Donate to the contract

<Tabs groupId="cli-tabs">
  <TabItem value="short" label="Short">

  ```bash
  # Replace <accountId> with your account ID
  # Require deposit
  near call donation.near-examples.testnet donate --accountId <accountId> --deposit 0.1
  ```
  </TabItem>

  <TabItem value="full" label="Full">

  ```bash
  # Replace <accountId> with your account ID
  # Require deposit
  near contract call-function as-transaction donation.near-examples.testnet donate json-args {} prepaid-gas '30.0 Tgas' attached-deposit '0.1 NEAR' sign-as <accountId> network-config testnet sign-with-keychain send
  ```
  </TabItem>
</Tabs>

<hr class="subsection" />

:::tip
If you're using your own account, replace `donation.near-examples.testnet` with your `accountId`.
:::

---

## Moving Forward

A nice way to learn is by trying to expand a contract. Modify the donation example so it accumulates the tokens in the contract
instead of sending it immediately. Then, make a method that only the `beneficiary` can call to retrieve the tokens.

<MovingForwardSupportSection />

:::note Versioning for this article

At the time of this writing, this example works with the following versions:

- near-cli: `4.0.13`
- node: `18.19.1`
- rustc: `1.77.0`

:::
