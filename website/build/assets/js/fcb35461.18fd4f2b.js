"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3760],{27128:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var a=n(85893),r=n(11151),o=n(71183);const i={id:"auction-factory",title:"Auction factory",sidebar_label:"Auction Factory"},c=void 0,l={id:"tutorials/auction/auction-factory",title:"Auction factory",description:"Since an auction contract hosts a single auction, each time you would like to host a new auction you will need to deploy a new contract. Rather than finding the compiled WASM file, creating a new account, deploying the contract, and then initializing it each time, you can use a factory contract to do this for you.",source:"@site/../docs/3.tutorials/auction/4-factory.md",sourceDirName:"3.tutorials/auction",slug:"/tutorials/auction/auction-factory",permalink:"/tutorials/auction/auction-factory",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/3.tutorials/auction/4-factory.md",tags:[],version:"current",lastUpdatedBy:"Owen",lastUpdatedAt:172898398e4,sidebarPosition:4,frontMatter:{id:"auction-factory",title:"Auction factory",sidebar_label:"Auction Factory"},sidebar:"tutorials",previous:{title:"Updating the Frontend",permalink:"/tutorials/auction/updating-the-frontend"},next:{title:"BOS Loader",permalink:"/tutorials/near-components/bos-loader"}},s={},u=[{value:"Changing the default contract",id:"changing-the-default-contract",level:2},{value:"Modifying deploy method",id:"modifying-deploy-method",level:2},{value:"Using the factory",id:"using-the-factory",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(t){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",hr:"hr",p:"p",pre:"pre",...(0,r.a)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"Since an auction contract hosts a single auction, each time you would like to host a new auction you will need to deploy a new contract. Rather than finding the compiled WASM file, creating a new account, deploying the contract, and then initializing it each time, you can use a factory contract to do this for you."}),"\n",(0,a.jsxs)(e.p,{children:["Luckily for us, there is already a ",(0,a.jsx)(e.a,{href:"https://github.com/near-examples/factory-rust",children:"factory contract example"}),"! We will fork this example and slightly modify it to suit our use case. If you would like to learn more about how the factory contract works, you can take a look at the ",(0,a.jsx)(e.a,{href:"https://docs.near.org/tutorials/examples/factory#generic-factory",children:"associated documentation"}),"."]}),"\n",(0,a.jsx)(e.p,{children:"The factory example only comes in rust since, currently, the JavaScript SDK does not allow you to embed the WASM file in the contract. This is a limitation of the SDK and not the blockchain itself."}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"changing-the-default-contract",children:"Changing the default contract"}),"\n",(0,a.jsx)(e.p,{children:"In the current example, the factory contract deploys the donation contract example. We will change this to deploy our auction contract instead."}),"\n",(0,a.jsxs)(e.p,{children:["Firstly, we'll need the compiled auction contract WASM file. You can get this by running the following command in ",(0,a.jsx)(e.a,{href:"https://github.com/near-examples/auctions-tutorial/tree/reorg-auction/contract-rs/03-bid-with-fts",children:"03-bid-with-fts"})," of ",(0,a.jsx)(e.code,{children:"contract-rs"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"cargo near build \n"})}),"\n",(0,a.jsxs)(e.p,{children:["You will find the resulting WASM file in ",(0,a.jsx)(e.code,{children:"target/near"}),"; copy this file and use it to replace the WASM of the donation contract in the factory contract's source folder. Now edit the auction contract changing the path to the auction contract."]}),"\n",(0,a.jsxs)(o.SQ,{value:"rust",language:"rust",children:[(0,a.jsx)(o.Ey,{fname:"Default init",url:"https://github.com/near-examples/auctions-tutorial/blob/main/factory/src/lib.rs#L25-L31",start:"25",end:"31"}),(0,a.jsx)(o.Ey,{fname:"Contract path",url:"https://github.com/near-examples/auctions-tutorial/blob/main/factory/src/lib.rs#L9",start:"9",end:"9"})]}),"\n",(0,a.jsxs)(e.p,{children:["On initialization, the factory will add the auction contracts WASM, as bytes, to the factory's state. It is more efficient to not store the WASM in the factory's state, however, we may want to update the auction contract if we find a bug or want to add new features. The factory implements a method to update the auction contract - we'll change the name to ",(0,a.jsx)(e.code,{children:"update_auction_contract"})," as this factory will only deploy auction contracts."]}),"\n",(0,a.jsx)(o.Ey,{fname:"Contract path",language:"rust",url:"https://github.com/near-examples/auctions-tutorial/blob/main/factory/src/manager.rs#L8-L13",start:"8",end:"13"}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"modifying-deploy-method",children:"Modifying deploy method"}),"\n",(0,a.jsx)(e.p,{children:"The method to deploy a new contract is specific to the contract being deployed (in the case the contract has custom initialization parameters). We will modify the method to take in the auction contract's initialization parameters."}),"\n",(0,a.jsx)(o.Ey,{fname:"Contract path",language:"rust",url:"https://github.com/near-examples/auctions-tutorial/blob/main/factory/src/deploy.rs#L9-L82",start:"9",end:"82"}),"\n",(0,a.jsxs)(e.p,{children:["In this fork, we have also removed the option to add an access key to the contract account since, as discussed ",(0,a.jsx)(e.a,{href:"/tutorials/auction/deploy#locking-the-contract",children:"earlier"}),", we want auctions to be locked."]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"using-the-factory",children:"Using the factory"}),"\n",(0,a.jsx)(e.p,{children:"Build and deploy the factory like you would any other contract, this time without any initialization parameters."}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"# compile the contract using cargo-near\ncargo near build\n\n# deploy the contract\nnear deploy <contractId> ./target/near/contract.wasm\n"})}),"\n",(0,a.jsx)(e.p,{children:"You can now use the factory to deploy new auction contracts, here is an example command."}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near call auction-factory.testnet deploy_new_auction \'{"name": "new-auction", "end_time": "3000000000000000000", "auctioneer": "pivortex.testnet", "ft_contract": "dai.fakes.testnet", "nft_contract": "nft.examples.testnet", "token_id": "7777", "starting_price": "1000000000000000000"}\' --accountId pivortex.testnet --deposit 1.6 --gas 100000000000000\n'})}),"\n",(0,a.jsx)(e.admonition,{title:"Deposit and storage costs",type:"info",children:(0,a.jsx)(e.p,{children:"Note that we attach 1.6 $NEAR to the call to cover the storage costs of deploying the new auction. The storage cost on NEAR is 1 $NEAR per 100 kb, and our auction contract is around 140 kb, but we'll add a little to cover the storage used on initialization."})}),"\n",(0,a.jsxs)(e.p,{children:["The command results in a fresh auction contract being deployed and initialized at ",(0,a.jsx)(e.code,{children:"new-auction.auction-factory.testnet"}),"."]}),"\n",(0,a.jsx)(e.hr,{}),"\n",(0,a.jsx)(e.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsxs)(e.p,{children:["In this part of the tutorial, you have learned how to fork and modify the factory contract example to deploy our auction contracts. You have also learned how to use the factory to deploy new auction contracts. If you're feeling adventurous you could create a frontend to interact with the factory contract to make it even easier to deploy new auctions. If you do so feel free to share it in our developer ",(0,a.jsx)(e.a,{href:"https://t.me/neardev",children:"Telegram"})," or ",(0,a.jsx)(e.a,{href:"https://discord.gg/vMGH5QywTH",children:"Discord"})," channels!"]}),"\n",(0,a.jsx)(e.p,{children:"And with that, this tutorial series is over, congratulations! Through this tutorial, we've built an auction contract and iterated on it adding improvements and extending its functionality, created a frontend to interact with the auction, used an API to index previous bids, and deployed a factory contract to make deploying new auctions easier. Along the way we've learned a great deal about NEAR, we learned about the anatomy of smart contracts, how to lock a contract to make it more secure, how to use primitives such as NFTs and FTs, how to perform cross-contract calls, how to use wallets from a frontend to interact with the blockchain and display data about a smart contract, how to pull historical data from the blockchain using an API, how to deploy contracts from other contracts and a lot of other little bits that will help you in the future."}),"\n",(0,a.jsx)(e.p,{children:"That's a lot, so once again congratulations!"})]})}function h(t={}){const{wrapper:e}={...(0,r.a)(),...t.components};return e?(0,a.jsx)(e,{...t,children:(0,a.jsx)(d,{...t})}):d(t)}},85162:(t,e,n)=>{n.d(e,{Z:()=>i});n(67294);var a=n(36905);const r={tabItem:"tabItem_Ymn6"};var o=n(85893);function i(t){var e=t.children,n=t.hidden,i=t.className;return(0,o.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,i),hidden:n,children:e})}},74866:(t,e,n)=>{n.d(e,{Z:()=>j});var a=n(67294),r=n(36905),o=n(12466),i=n(16550),c=n(20469),l=n(91980),s=n(67392),u=n(20812);function d(t){var e,n;return null!=(e=null==(n=a.Children.toArray(t).filter((function(t){return"\n"!==t})).map((function(t){if(!t||(0,a.isValidElement)(t)&&((e=t.props)&&"object"==typeof e&&"value"in e))return t;var e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof t.type?t.type:t.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:n.filter(Boolean))?e:[]}function h(t){var e=t.values,n=t.children;return(0,a.useMemo)((function(){var t=null!=e?e:function(t){return d(t).map((function(t){var e=t.props;return{value:e.value,label:e.label,attributes:e.attributes,default:e.default}}))}(n);return function(t){var e=(0,s.lx)(t,(function(t,e){return t.value===e.value}));if(e.length>0)throw new Error('Docusaurus error: Duplicate values "'+e.map((function(t){return t.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(t),t}),[e,n])}function f(t){var e=t.value;return t.tabValues.some((function(t){return t.value===e}))}function p(t){var e=t.queryString,n=void 0!==e&&e,r=t.groupId,o=(0,i.k6)(),c=function(t){var e=t.queryString,n=void 0!==e&&e,a=t.groupId;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:n,groupId:r});return[(0,l._X)(c),(0,a.useCallback)((function(t){if(c){var e=new URLSearchParams(o.location.search);e.set(c,t),o.replace(Object.assign({},o.location,{search:e.toString()}))}}),[c,o])]}function m(t){var e,n,r,o,i=t.defaultValue,l=t.queryString,s=void 0!==l&&l,d=t.groupId,m=h(t),g=(0,a.useState)((function(){return function(t){var e,n=t.defaultValue,a=t.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!f({value:n,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+n+'" but none of its children has the corresponding value. Available values are: '+a.map((function(t){return t.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return n}var r=null!=(e=a.find((function(t){return t.default})))?e:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:i,tabValues:m})})),y=g[0],b=g[1],v=p({queryString:s,groupId:d}),x=v[0],w=v[1],j=(e=function(t){return t?"docusaurus.tab."+t:null}({groupId:d}.groupId),n=(0,u.Nk)(e),r=n[0],o=n[1],[r,(0,a.useCallback)((function(t){e&&o.set(t)}),[e,o])]),k=j[0],S=j[1],I=function(){var t=null!=x?x:k;return f({value:t,tabValues:m})?t:null}();return(0,c.Z)((function(){I&&b(I)}),[I]),{selectedValue:y,selectValue:(0,a.useCallback)((function(t){if(!f({value:t,tabValues:m}))throw new Error("Can't select invalid tab value="+t);b(t),w(t),S(t)}),[w,S,m]),tabValues:m}}var g=n(72389);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=n(85893);function v(t){var e=t.className,n=t.block,a=t.selectedValue,i=t.selectValue,c=t.tabValues,l=[],s=(0,o.o5)().blockElementScrollPositionUntilNextRender,u=function(t){var e=t.currentTarget,n=l.indexOf(e),r=c[n].value;r!==a&&(s(e),i(r))},d=function(t){var e,n=null;switch(t.key){case"Enter":u(t);break;case"ArrowRight":var a,r=l.indexOf(t.currentTarget)+1;n=null!=(a=l[r])?a:l[0];break;case"ArrowLeft":var o,i=l.indexOf(t.currentTarget)-1;n=null!=(o=l[i])?o:l[l.length-1]}null==(e=n)||e.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},e),children:c.map((function(t){var e=t.value,n=t.label,o=t.attributes;return(0,b.jsx)("li",Object.assign({role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:function(t){return l.push(t)},onKeyDown:d,onClick:u},o,{className:(0,r.Z)("tabs__item",y.tabItem,null==o?void 0:o.className,{"tabs__item--active":a===e}),children:null!=n?n:e}),e)}))})}function x(t){var e=t.lazy,n=t.children,o=t.selectedValue,i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){var c=i.find((function(t){return t.props.value===o}));return c?(0,a.cloneElement)(c,{className:(0,r.Z)("margin-top--md",c.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map((function(t,e){return(0,a.cloneElement)(t,{key:e,hidden:t.props.value!==o})}))})}function w(t){var e=m(t);return(0,b.jsxs)("div",{className:(0,r.Z)("tabs-container",y.tabList),children:[(0,b.jsx)(v,Object.assign({},e,t)),(0,b.jsx)(x,Object.assign({},e,t))]})}function j(t){var e=(0,g.Z)();return(0,b.jsx)(w,Object.assign({},t,{children:d(t.children)}),String(e))}},71183:(t,e,n)=>{n.d(e,{O2:()=>p,Ey:()=>g,SQ:()=>m});var a=n(67294),r=n(74866),o=n(85162),i=n(74165),c=n(15861),l=n(1841),s=n.n(l),u=n(85893);function d(){return(d=(0,c.Z)((0,i.Z)().mark((function t(e,n,a){var r,o,c,l;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((o=localStorage.getItem(e+"-until"))&&o>Date.now())){t.next=5;break}r=localStorage.getItem(e),t.next=18;break;case 5:return t.prev=5,t.next=8,fetch(e);case 8:return t.next=10,t.sent.text();case 10:r=t.sent,localStorage.setItem(e,r),localStorage.setItem(e+"-until",Date.now()+6e4),t.next=18;break;case 15:return t.prev=15,t.t0=t.catch(5),t.abrupt("return","Error fetching code, please try reloading");case 18:return c=r.split("\n"),n=n?Number(n)-1:0,a=a?Number(a):c.length,c=c.slice(n,a),l=c.reduce((function(t,e){if(0===e.length)return t;var n=e.match(/^\s+/);return n?Math.min(t,n[0].length):0}),1/0),t.abrupt("return",c.map((function(t){return t.slice(l)})).join("\n"));case 24:case"end":return t.stop()}}),t,null,[[5,15]])})))).apply(this,arguments)}const h=function(t){var e=t.url,n=t.start,r=t.end,o=t.language,i=t.fname,c=t.metastring,l=(0,a.useState)("Loading..."),h=l[0],f=l[1];return(0,a.useEffect)((function(){var t=function(t){var e=t.slice(t.indexOf("https")).split("#"),n=e[0],a=(e[1],new URL(n).pathname.split("/").slice(1)),r=a[0],o=a[1];return a[2],"https://raw.githubusercontent.com/"+r+"/"+o+"/"+a[3]+"/"+a.slice(4).join("/")}(e),a=function(t,e,n){return d.apply(this,arguments)}(t,n,r);a.then((function(t){return f(t)}))})),(0,u.jsxs)("div",{fname:i,children:[(0,u.jsx)(s(),{language:o,metastring:c+" showLineNumbers",children:h}),(0,u.jsx)("div",{style:{fontSize:"0.9em",fontWeight:600,color:"rgb(14, 117, 221)",textAlign:"center",paddingBottom:"13px",textDecoration:"underline"},children:(0,u.jsx)("a",{href:e,target:"_blank",rel:"noreferrer noopener",children:"See full example on GitHub"})})]})};var f={rust:"\ud83e\udd80 Rust",js:"\ud83c\udf10 Javascript",ts:"\ud83c\udf10 Typescript"};function p(t){var e=t.children;return Array.isArray(e)||(e=[e]),(0,u.jsx)(r.Z,{className:"language-tabs",groupId:"code-tabs",children:e.map((function(t,e){return(0,u.jsx)(o.Z,{value:t.props.value,label:f[t.props.value],children:t})}))})}function m(t){var e=t.children,n=t.language,a=t.showSingleFName;return Array.isArray(e)||(e=[e]),e=e.map((function(t){return function(t,e){var n=t.props,a=(n.children,n.url),r=n.start,o=n.end,i=n.fname;if(t.type===g)return g({url:a,start:r,end:o,language:e,fname:i});return t}(t,n)})),1!=e.length||a?(0,u.jsx)(r.Z,{className:"file-tabs",children:e.map((function(t,e){return(0,u.jsx)(o.Z,{value:e,label:t.props.fname,children:t})}))}):(0,u.jsx)(o.Z,{value:0,label:e[0].props.fname,children:e[0]})}function g(t){var e=t.url,n=t.start,a=t.end,r=t.language,o=t.fname,i=t.metastring;return h({url:e,start:n,end:a,language:r,fname:o,metastring:i})}}}]);