"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7094],{2886:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>h,toc:()=>l});var c=e(85893),a=e(11151),r=e(77229);const i={id:"approvals",title:"Approval",sidebar_label:"Approval"},o=void 0,h={id:"tutorials/nfts/approvals",title:"Approval",description:"Trong b\xe0i h\u01b0\u1edbng d\u1eabn n\xe0y b\u1ea1n s\u1ebd h\u1ecdc \u0111\u01b0\u1ee3c nh\u1eefng \u0111i\u1ec1u c\u01a1 b\u1ea3n c\u1ee7a m\u1ed9t h\u1ec7 th\u1ed1ng approval management, n\xf3 s\u1ebd cho ph\xe9p b\u1ea1n c\u1ea5p quy\u1ec1n truy c\u1eadp cho ng\u01b0\u1eddi kh\xe1c \u0111\u1ec3 transfer c\xe1c NFT thay m\xecnh. \u0110\xe2y l\xe0 x\u01b0\u01a1ng s\u1ed1ng c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c NFT marketplace v\xe0 cho ph\xe9p m\u1ed9t s\u1ed1 t\xecnh hu\u1ed1ng ph\u1ee9c t\u1ea1p nh\u01b0ng c\u1ea7n thi\u1ebft x\u1ea3y ra. N\u1ebfu b\u1ea1n tham gia v\u1edbi ch\xfang t\xf4i l\u1ea7n \u0111\u1ea7u, \u0111\u1eebng ng\u1ea1i clone repository n\xe0y v\xe0 checkout branch 4.core \u0111\u1ec3 theo d\xf5i.",source:"@site/i18n/vi/docusaurus-plugin-content-docs/current/3.tutorials/nfts/5-approval.md",sourceDirName:"3.tutorials/nfts",slug:"/tutorials/nfts/approvals",permalink:"/vi/tutorials/nfts/approvals",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/3.tutorials/nfts/5-approval.md",tags:[],version:"current",lastUpdatedBy:"Github Actions",lastUpdatedAt:1709152665e3,sidebarPosition:5,frontMatter:{id:"approvals",title:"Approval",sidebar_label:"Approval"},sidebar:"tutorials",previous:{title:"Event",permalink:"/vi/tutorials/nfts/events"},next:{title:"Marketplace",permalink:"/vi/tutorials/nfts/marketplace"}},s={},l=[{value:"Gi\u1edbi thi\u1ec7u",id:"gi\u1edbi-thi\u1ec7u",level:2},{value:"Cho ph\xe9p m\u1ed9t account transfer NFT c\u1ee7a b\u1ea1n",id:"cho-ph\xe9p-m\u1ed9t-account-transfer-nft-c\u1ee7a-b\u1ea1n",level:2},{value:"V\u1ea5n \u0111\u1ec1",id:"the-problem",level:3},{value:"Gi\u1ea3i ph\xe1p",id:"the-solution",level:3},{value:"M\u1edf r\u1ed9ng c\xe1c c\u1ea5u tr\xfac <code>Token</code> and <code>JsonToken</code>",id:"m\u1edf-r\u1ed9ng-c\xe1c-c\u1ea5u-tr\xfac-token-and-jsontoken",level:3},{value:"C\xe1c approve account",id:"c\xe1c-approve-account",level:3},{value:"T\xedch h\u1ee3p marketplace",id:"marketplace-integrations",level:4},{value:"C\xe1c Internal function",id:"c\xe1c-internal-function",level:4},{value:"Thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer c\xe1c NFT",id:"thay-\u0111\u1ed5i-c\xe1c-h\u1ea1n-ch\u1ebf-cho-vi\u1ec7c-transfer-c\xe1c-nft",level:3},{value:"Ho\xe0n tr\u1ea3 storage khi transfer",id:"ho\xe0n-tr\u1ea3-storage-khi-transfer",level:4},{value:"C\xe1c thay \u0111\u1ed5i v\u1edbi <code>nft_core.rs</code>",id:"c\xe1c-thay-\u0111\u1ed5i-v\u1edbi-nft_corers",level:3},{value:"Ki\u1ec3m tra m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng",id:"ki\u1ec3m-tra-m\u1ed9t-account-\u0111\u01b0\u1ee3c-ch\u1ea5p-thu\u1eadn-hay-kh\xf4ng",level:2},{value:"Thu h\u1ed3i account",id:"thu-h\u1ed3i-account",level:2},{value:"Thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account",id:"thu-h\u1ed3i-to\xe0n-b\u1ed9-c\xe1c-account",level:2},{value:"Test c\xe1c thay \u0111\u1ed5i m\u1edbi",id:"testing-changes",level:2},{value:"Deployment",id:"deployment",level:3},{value:"Kh\u1edfi t\u1ea1o v\xe0 mint",id:"initialization-and-minting",level:3},{value:"Ch\u1ea5p thu\u1eadn m\u1ed9t account",id:"approving-an-account",level:3},{value:"Transfer NFT b\u1eb1ng m\u1ed9t approve account",id:"transferring-the-nft",level:3},{value:"T\u1ed5ng k\u1ebft",id:"t\u1ed5ng-k\u1ebft",level:2}];function u(n){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...n.components},{Details:e}=t;return e||function(n,t){throw new Error("Expected "+(t?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(t.p,{children:["Trong b\xe0i h\u01b0\u1edbng d\u1eabn n\xe0y b\u1ea1n s\u1ebd h\u1ecdc \u0111\u01b0\u1ee3c nh\u1eefng \u0111i\u1ec1u c\u01a1 b\u1ea3n c\u1ee7a m\u1ed9t h\u1ec7 th\u1ed1ng approval management, n\xf3 s\u1ebd cho ph\xe9p b\u1ea1n c\u1ea5p quy\u1ec1n truy c\u1eadp cho ng\u01b0\u1eddi kh\xe1c \u0111\u1ec3 transfer c\xe1c NFT thay m\xecnh. \u0110\xe2y l\xe0 x\u01b0\u01a1ng s\u1ed1ng c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c NFT marketplace v\xe0 cho ph\xe9p m\u1ed9t s\u1ed1 t\xecnh hu\u1ed1ng ph\u1ee9c t\u1ea1p nh\u01b0ng c\u1ea7n thi\u1ebft x\u1ea3y ra. N\u1ebfu b\u1ea1n tham gia v\u1edbi ch\xfang t\xf4i l\u1ea7n \u0111\u1ea7u, \u0111\u1eebng ng\u1ea1i clone ",(0,c.jsx)(t.a,{href:"https://github.com/near-examples/nft-tutorial",children:"repository n\xe0y"})," v\xe0 checkout branch ",(0,c.jsx)(t.code,{children:"4.core"})," \u0111\u1ec3 theo d\xf5i."]}),"\n",(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"git checkout 4.core\n"})}),"\n",(0,c.jsxs)(t.admonition,{type:"tip",children:[(0,c.jsxs)(t.mdxAdmonitionTitle,{children:["If you wish to see the finished code for this ",(0,c.jsx)(t.em,{children:"Approval"})," tutorial, you can find it on the ",(0,c.jsx)(t.code,{children:"5.approval"})," branch. :::"]}),(0,c.jsx)(t.h2,{id:"gi\u1edbi-thi\u1ec7u",children:"Gi\u1edbi thi\u1ec7u"}),(0,c.jsxs)(t.p,{children:["Up until this point you've created a smart contract that allows users to mint and transfer NFTs as well as query for information using the ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Enumeration",children:"enumeration standard"}),". Nh\u01b0 ch\xfang ta \u0111\xe3 l\xe0m trong c\xe1c h\u01b0\u1edbng d\u1eabn tr\u01b0\u1edbc, h\xe3y chia v\u1ea5n \u0111\u1ec1 th\xe0nh c\xe1c nhi\u1ec7m v\u1ee5 nh\u1ecf h\u01a1n, d\u1ec5 x\u1eed l\xfd. Let's first define some of the end goals that we want to accomplish as per the ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"approval management"})," extension of the standard. Ch\xfang ta mu\u1ed1n user c\xf3 kh\u1ea3 n\u0103ng:"]}),(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsx)(t.li,{children:"Grant other accounts access to transfer their NFTs on a per token basis."}),"\n",(0,c.jsx)(t.li,{children:"Check if an account has access to a specific token."}),"\n",(0,c.jsx)(t.li,{children:"Revoke a specific account the ability to transfer an NFT."}),"\n",(0,c.jsxs)(t.li,{children:["Revoke ",(0,c.jsx)(t.strong,{children:"all"})," other accounts the ability to transfer an NFT."]}),"\n"]}),(0,c.jsxs)(t.p,{children:["N\u1ebfu b\u1ea1n nh\xecn v\xe0o t\u1ea5t c\u1ea3 c\xe1c m\u1ee5c ti\xeau n\xe0y, ch\xfang \u0111\u1ec1u d\u1ef1a tr\xean c\u01a1 s\u1edf m\u1ed7i token. \u0110\xe2y l\xe0 m\u1ed9t d\u1ea5u hi\u1ec7u r\xf5 r\xe0ng r\u1eb1ng b\u1ea1n n\xean thay \u0111\u1ed5i c\u1ea5u tr\xfac ",(0,c.jsx)(t.code,{children:"Token"})," \u0111\u1ec3 theo d\xf5i th\xf4ng tin cho t\u1eebng token."]}),(0,c.jsx)(t.h2,{id:"cho-ph\xe9p-m\u1ed9t-account-transfer-nft-c\u1ee7a-b\u1ea1n",children:"Cho ph\xe9p m\u1ed9t account transfer NFT c\u1ee7a b\u1ea1n"}),(0,c.jsx)(t.p,{children:"H\xe3y b\u1eaft \u0111\u1ea7u b\u1eb1ng c\xe1ch c\u1ed1 g\u1eafng ho\xe0n th\xe0nh m\u1ee5c ti\xeau \u0111\u1ea7u ti\xean. L\xe0m c\xe1ch n\xe0o b\u1ea1n c\xf3 th\u1ec3 c\u1ea5p cho m\u1ed9t account kh\xe1c quy\u1ec1n truy c\u1eadp \u0111\u1ec3 thay b\u1ea1n chuy\u1ec3n m\u1ed9t NFT?"}),(0,c.jsxs)(t.p,{children:["C\xe1ch \u0111\u01a1n gi\u1ea3n nh\u1ea5t m\xe0 b\u1ea1n c\xf3 th\u1ec3 l\xe0m l\xe0 th\xeam danh s\xe1ch c\xe1c account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn v\xe0o c\u1ea5u tr\xfac ",(0,c.jsx)(t.code,{children:"Token"}),". Khi transfer NFT, n\u1ebfu ng\u01b0\u1eddi g\u1ecdi kh\xf4ng ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu, b\u1ea1n c\xf3 th\u1ec3 ki\u1ec3m tra xem h\u1ecd c\xf3 trong danh s\xe1ch n\xe0y hay kh\xf4ng."]}),(0,c.jsx)(t.p,{children:"Tr\u01b0\u1edbc khi transfer, b\u1ea1n c\u1ea7n xo\xe1 danh s\xe1ch c\xe1c account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn v\xec ch\u1ee7 s\u1edf h\u1eefu m\u1edbi s\u1ebd kh\xf4ng mu\u1ed1n c\xe1c account \u0111\u01b0\u1ee3c ch\u1ee7 s\u1edf h\u1eefu ban \u0111\u1ea7u ch\u1ea5p thu\u1eadn v\u1eabn c\xf3 quy\u1ec1n truy c\u1eadp \u0111\u1ec3 transfer NFT m\u1edbi c\u1ee7a h\u1ecd."}),(0,c.jsx)(t.h3,{id:"the-problem",children:"V\u1ea5n \u0111\u1ec1"}),(0,c.jsx)(t.p,{children:"Nh\xecn b\xean ngo\xe0i, \u0111i\u1ec1u n\xe0y s\u1ebd ho\u1ea1t \u0111\u1ed9ng, nh\u01b0ng n\u1ebfu b\u1ea1n b\u1eaft \u0111\u1ea7u ngh\u0129 v\u1ec1 c\xe1c tr\u01b0\u1eddng h\u1ee3p ph\u1ee9c t\u1ea1p, m\u1ed9t s\u1ed1 v\u1ea5n \u0111\u1ec1 s\u1ebd n\u1ea3y sinh. Th\xf4ng th\u01b0\u1eddng khi th\u1ef1c hi\u1ec7n development, m\u1ed9t c\xe1ch ti\u1ebfp c\u1eadn ph\u1ed5 bi\u1ebfn l\xe0 ngh\u0129 v\u1ec1 gi\u1ea3i ph\xe1p d\u1ec5 d\xe0ng v\xe0 \u0111\u01a1n gi\u1ea3n nh\u1ea5t. Khi b\u1ea1n \u0111\xe3 t\xecm gi\u1ea3i ph\xe1p, b\u1ea1n c\xf3 th\u1ec3 b\u1eaft \u0111\u1ea7u ph\xe2n nh\xe1nh \u0111\u1ec3 suy ngh\u0129 v\u1ec1 c\xe1ch t\u1ed1i \u01b0u h\xf3a v\xe0 c\xe1c tr\u01b0\u1eddng ph\u1ee9c t\u1ea1p."}),(0,c.jsxs)(t.p,{children:["H\xe3y xem x\xe9t k\u1ecbch b\u1ea3n sau \u0111\xe2y. Benji c\xf3 m\u1ed9t NFT v\xe0 c\u1ea5p cho hai marketplace ri\xeang bi\u1ec7t quy\u1ec1n truy c\u1eadp \u0111\u1ec3 transfer token c\u1ee7a m\xecnh. B\u1eb1ng c\xe1ch l\xe0m nh\u01b0 v\u1eady, anh \u1ea5y \u0111ang \u0111\u1eb7t b\xe1n NFT (t\xecm hi\u1ec3u th\xeam v\u1ec1 \u0111i\u1ec1u \u0111\xf3 trong ph\u1ea7n ",(0,c.jsx)(t.a,{href:"#marketplace-integrations",children:" t\xedch h\u1ee3p marketplace"}),"). Gi\u1ea3 s\u1eed anh \u1ea5y \u0111\u1eb7t b\xe1n NFT v\u1edbi gi\xe1 1 NEAR tr\xean c\u1ea3 hai market. Danh s\xe1ch token c\u1ee7a c\xe1c approve account ID s\u1ebd gi\u1ed1ng nh\u01b0 sau:"]}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Benji\n    approved_accounts_ids: [marketplace A, marketplace B]\n}\n"})}),(0,c.jsx)(t.p,{children:"Josh sau \u0111\xf3 \u0111\u1ebfn v\xe0 mua NFT tr\xean marketplace A v\u1edbi gi\xe1 1 NEAR. \u0110i\u1ec1u n\xe0y s\u1ebd g\u1ee1 NFT \u0111ang b\xe1n kh\u1ecfi marketplace A v\xe0 xo\xe1 danh s\xe1ch c\xe1c account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn. Tuy nhi\xean v\u1eabn c\xf3 token \u0111\u01b0\u1ee3c b\xe1n v\u1edbi gi\xe1 1 NEAR tr\xean marketplace B v\xe0 kh\xf4ng c\xf3 c\xe1ch n\xe0o \u0111\u1ec3 bi\u1ebft r\u1eb1ng token n\xe0y \u0111\xe3 \u0111\u01b0\u1ee3c mua tr\xean marketplace A b\u1edfi Josh. C\u1ea5u tr\xfac token m\u1edbi s\u1ebd tr\xf4ng nh\u01b0 sau:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: []\n}\n"})}),(0,c.jsx)(t.p,{children:"Gi\u1ea3 s\u1eed Josh \u0111ang thi\u1ebfu ti\u1ec1n m\u1eb7t v\xe0 mu\u1ed1n \u0111\u1ea9y nhanh NFT n\xe0y \u0111i v\xe0 b\xe1n n\xf3 v\u1edbi gi\xe1 g\u1ea5p 10 l\u1ea7n gi\xe1 tr\xean marketplace B. Anh ta b\xe1n n\xf3 v\xe0 v\xec l\xfd do n\xe0o \u0111\xf3, marketplace \u0111\u01b0\u1ee3c build theo c\xe1ch m\xe0 n\u1ebfu b\u1ea1n c\u1ed1 g\u1eafng \u0111\u01b0a m\u1ed9t token l\xean \u0111\u1ec3 b\xe1n hai l\u1ea7n, n\xf3 s\u1ebd gi\u1eef l\u1ea1i d\u1eef li\u1ec7u b\xe1n h\xe0ng c\u1ee7a l\u1ea7n \u0111\u1ea7u. \u0110i\u1ec1u n\xe0y c\xf3 ngh\u0129a r\u1eb1ng t\u1eeb g\xf3c nh\xecn c\u1ee7a marketplace B, token v\u1eabn \u0111\u01b0\u1ee3c b\xe1n v\u1edbi gi\xe1 1 NEAR (\u0111\xf3 l\xe0 gi\xe1 m\xe0 Benji \u0111\xe3 ni\xeam y\u1ebft ban \u0111\u1ea7u)."}),(0,c.jsx)(t.p,{children:"V\xec Josh \u0111\xe3 ch\u1ea5p thu\u1eadn cho marketplace th\u1eed v\xe0 b\xe1n n\xf3, c\u1ea5u tr\xfac token s\u1ebd tr\xf4ng nh\u01b0 sau:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: [marketplace A, marketplace B]\n}\n"})}),(0,c.jsx)(t.p,{children:"N\u1ebfu sau \u0111\xf3 Mike \u0111\u1ebfn v\xe0 mua NFT ch\u1ec9 v\u1edbi 1 NEAR tr\xean marketplace B, marketplace s\u1ebd th\u1eed chuy\u1ec3n NFT v\xe0 v\u1ec1 m\u1eb7t k\u1ef9 thu\u1eadt, Josh \u0111\xe3 ch\u1ea5p thu\u1eadn marketplace v\xe0 n\xf3 \u0111\u01b0\u1ee3c n\u1eb1m trong danh s\xe1ch c\xe1c approve account, giao d\u1ecbch s\u1ebd di\u1ec5n ra b\xecnh th\u01b0\u1eddng."}),(0,c.jsx)(t.h3,{id:"the-solution",children:"Gi\u1ea3i ph\xe1p"}),(0,c.jsxs)(t.p,{children:["B\xe2y gi\u1edd ch\xfang ta \u0111\xe3 x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1ee3c v\u1ea5n \u0111\u1ec1 v\u1edbi gi\u1ea3i ph\xe1p ban \u0111\u1ea7u, h\xe3y ngh\u0129 v\u1ec1 nh\u1eefng c\xe1ch m\xe0 ch\xfang ta c\xf3 th\u1ec3 kh\u1eafc ph\u1ee5c n\xf3. \u0110i\u1ec1u g\xec s\u1ebd x\u1ea3y ra n\u1ebfu b\xe2y gi\u1edd, thay v\xec ch\u1ec9 theo d\xf5i danh s\xe1ch c\xe1c approve account, b\u1ea1n th\xeam m\u1ed9t ID \u0111\u1eb7c bi\u1ec7t \u0111i c\xf9ng v\u1edbi m\u1ed7i approve account. C\xe1c approve account m\u1edbi b\xe2y gi\u1edd s\u1ebd l\xe0 m\u1ed9t map thay v\xec m\u1ed9t list. N\xf3 s\u1ebd map m\u1ed9t account t\u1edbi ",(0,c.jsx)(t.code,{children:"approval id"})," c\u1ee7a n\xf3."]}),(0,c.jsxs)(t.p,{children:["\u0110\u1ec3 \u0111i\u1ec1u n\xe0y ho\u1ea1t \u0111\u1ed9ng, b\u1ea1n c\u1ea7n \u0111\u1ea3m b\u1ea3o r\u1eb1ng approval ID ",(0,c.jsx)(t.strong,{children:"lu\xf4n lu\xf4n"})," l\xe0 m\u1ed9t ID m\u1edbi v\xe0 unique. N\u1ebfu b\u1ea1n \u0111\u1eb7t n\xf3 l\xe0 m\u1ed9t integer lu\xf4n t\u0103ng 1 \u0111\u01a1n v\u1ecb b\u1ea5t c\u1ee9 khi n\xe0o b\u1ea1n ch\u1ea5p thu\u1eadn m\u1ed9t account, n\xf3 s\u1ebd ho\u1ea1t \u0111\u1ed9ng. H\xe3y xem x\xe9t c\xf9ng m\u1ed9t k\u1ecbch b\u1ea3n v\u1edbi gi\u1ea3i ph\xe1p m\u1edbi."]}),(0,c.jsx)(t.p,{children:'Benji b\xe1n NFT c\u1ee7a m\xecnh v\u1edbi gi\xe1 1 NEAR tr\xean marketplace A v\xe0 marketplace B b\u1eb1ng c\xe1ch ch\u1ea5p thu\u1eadn c\u1ea3 hai marketplace. "Next approval ID" s\u1ebd b\u1eaft \u0111\u1ea7u t\u1eeb 0 khi NFT \u0111\u01b0\u1ee3c mint l\u1ea7n \u0111\u1ea7u ti\xean v\xe0 s\u1ebd t\u0103ng l\xean t\u1eeb con s\u1ed1 \u0111\xf3. \u0110i\u1ec1u n\xe0y s\u1ebd d\u1eabn \u0111\u1ebfn c\u1ea5u tr\xfac token nh\u01b0 sau:'}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Benji\n    approved_accounts_ids: {\n        marketplace A: 0\n        marketplace B: 1\n    }\n    next_approval_id: 2\n}\n"})}),(0,c.jsxs)(t.p,{children:["Khi Benji ch\u1ea5p thu\u1eadn marketplace A, gi\xe1 tr\u1ecb ban \u0111\u1ea7u c\u1ee7a ",(0,c.jsx)(t.code,{children:"next_approval_id"})," b\u1eaft \u0111\u1ea7u b\u1eb1ng 0. Sau \u0111\xf3 marketplace \u0111\u01b0\u1ee3c ch\xe8n v\xe0o map v\xe0 next approval ID \u0111\u01b0\u1ee3c t\u0103ng l\xean. Qu\xe1 tr\xecnh n\xe0y l\u1ea1i x\u1ea3y ra \u0111\u1ed1i v\u1edbi marketplace B v\xe0 next approval ID l\u1ea1i \u0111\u01b0\u1ee3c t\u0103ng l\xean, gi\xe1 tr\u1ecb hi\u1ec7n t\u1ea1i c\u1ee7a n\xf3 l\xe0 2."]}),(0,c.jsx)(t.p,{children:"Josh \u0111\u1ebfn v\xe0 mua NFT tr\xean marketplace A v\u1edbi gi\xe1 1 NEAR. L\u01b0u \xfd r\u1eb1ng next approval ID \u0111ang c\xf3 gi\xe1 tr\u1ecb l\xe0 2:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: {}\n    next_approval_id: 2\n}\n"})}),(0,c.jsx)(t.p,{children:"Josh sau \u0111\xf3 \u0111\u1ea9y nhanh NFT n\xe0y b\u1edfi v\xec anh \u1ea5y m\u1ed9t l\u1ea7n n\u1eefa thi\u1ebfu ti\u1ec1n m\u1eb7t v\xe0 ch\u1ea5p thu\u1eadn marketplace B:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: {\n        marketplace B: 2\n    }\n    next_approval_id: 3\n}\n"})}),(0,c.jsxs)(t.p,{children:["Marketplace \u0111\u01b0\u1ee3c ch\xe8n v\xe0o map v\xe0 next approval ID \u0111\u01b0\u1ee3c t\u0103ng l\xean. T\u1eeb g\xf3c nh\xecn c\u1ee7a marketplace B, n\xf3 l\u01b0u tr\u1eef approval ID ban \u0111\u1ea7u c\xf3 gi\xe1 tr\u1ecb l\xe0 1 t\u1eeb khi Benji b\xe1n NFT \u0111\xf3. N\u1ebfu Mike \u0111i v\xe0 mua NFT tr\xean marketplace B v\u1edbi gi\xe1 b\xe1n 1 NEAR ban \u0111\u1ea7u, NFT contract s\u1ebd b\u1ecb panic. \u0110i\u1ec1u n\xe0y l\xe0 do marketplace \u0111ang c\u1ed1 g\u1eafng chuy\u1ec3n NFT v\u1edbi approval ID l\xe0 1 nh\u01b0ng c\u1ea5u tr\xfac token cho th\u1ea5y r\u1eb1ng n\xf3 ",(0,c.jsx)(t.strong,{children:"n\xean"})," c\xf3 approval ID l\xe0 2."]}),(0,c.jsxs)(t.h3,{id:"m\u1edf-r\u1ed9ng-c\xe1c-c\u1ea5u-tr\xfac-token-and-jsontoken",children:["M\u1edf r\u1ed9ng c\xe1c c\u1ea5u tr\xfac ",(0,c.jsx)(t.code,{children:"Token"})," and ",(0,c.jsx)(t.code,{children:"JsonToken"})]}),(0,c.jsxs)(t.p,{children:["B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 hi\u1ec3u gi\u1ea3i ph\xe1p \u0111\u01b0\u1ee3c \u0111\u1ec1 xu\u1ea5t cho v\u1ea5n \u0111\u1ec1 ban \u0111\u1ea7u l\xe0 cho ph\xe9p account chuy\u1ec3n NFT c\u1ee7a b\u1ea1n, \u0111\xe3 \u0111\u1ebfn l\xfac th\u1ef1c hi\u1ec7n m\u1ed9t s\u1ed1 logic. \u0110i\u1ec1u \u0111\u1ea7u ti\xean b\u1ea1n n\xean l\xe0m l\xe0 s\u1eeda \u0111\u1ed5i c\u1ea5u tr\xfac c\u1ee7a ",(0,c.jsx)(t.code,{children:"Token"})," and ",(0,c.jsx)(t.code,{children:"JsonToken"})," \u0111\u1ec3 ph\u1ea3n \xe1nh nh\u1eefng thay \u0111\u1ed5i m\u1edbi. H\xe3y chuy\u1ec3n sang file ",(0,c.jsx)(t.code,{children:"nft-contract/src/metadata.rs"}),":"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"39",end:"61",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/metadata.rs"}),(0,c.jsxs)(t.p,{children:["You'll then need to initialize both the ",(0,c.jsx)(t.code,{children:"approved_account_ids"})," and ",(0,c.jsx)(t.code,{children:"next_approval_id"})," to their default values when a token is minted. Switch to the ",(0,c.jsx)(t.code,{children:"nft-contract/src/mint.rs"})," file and when creating the ",(0,c.jsx)(t.code,{children:"Token"})," struct to store in the contract, let's set the next approval ID to be 0 and the approved account IDs to be an empty map:"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"15",end:"22",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/mint.rs"}),(0,c.jsx)(t.h3,{id:"c\xe1c-approve-account",children:"C\xe1c approve account"}),(0,c.jsxs)(t.p,{children:["B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 th\xeam h\u1ed7 tr\u1ee3 cho c\xe1c approve account ID v\xe0 next approval ID \u1edf token level, \u0111\xe3 \u0111\u1ebfn l\xfac th\xeam logic \u0111\u1ec3 t\u1ea1o v\xe0 thay \u0111\u1ed5i c\xe1c field \u0111\xf3 th\xf4ng qua m\u1ed9t function g\u1ecdi l\xe0 ",(0,c.jsx)(t.code,{children:"nft_approve"}),". Function n\xe0y s\u1ebd ch\u1ea5p thu\u1eadn m\u1ed9t account \u0111\u1ec3 c\xf3 quy\u1ec1n truy c\u1eadp v\xe0o m\u1ed9t token ID c\u1ee5 th\u1ec3. H\xe3y chuy\u1ec3n \u0111\u1ebfn file ",(0,c.jsx)(t.code,{children:"nft-contract/src/approval.rs"})," v\xe0 ch\u1ec9nh s\u1eeda function ",(0,c.jsx)(t.code,{children:"nft_approve"}),":"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"38",end:"96",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/approval.rs"}),(0,c.jsxs)(t.p,{children:["Tr\u01b0\u1edbc ti\xean, function s\u1ebd x\xe1c nh\u1eadn r\u1eb1ng ng\u01b0\u1eddi d\xf9ng \u0111\xe3 \u0111\xednh k\xe8m ",(0,c.jsx)(t.strong,{children:"\xedt nh\u1ea5t"})," m\u1ed9t yoctoNEAR (ch\xfat n\u1eefa ch\xfang ta s\u1ebd tri\u1ec3n khai). \u0110i\u1ec1u n\xe0y \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o security v\xe0 tr\u1ea3 ph\xed storage. Khi ai \u0111\xf3 ch\u1ea5p thu\u1eadn m\u1ed9t account ID, h\u1ecd s\u1ebd l\u01b0u tr\u1eef th\xf4ng tin \u0111\xf3 tr\xean contract. Nh\u01b0 b\u1ea1n \u0111\xe3 th\u1ea5y trong ",(0,c.jsx)(t.a,{href:"/tutorials/nfts/minting",children:"h\u01b0\u1edbng d\u1eabn mint"}),", b\u1ea1n c\xf3 th\u1ec3 y\xeau c\u1ea7u smart contract account thanh to\xe1n cho storage, ho\u1eb7c b\u1ea1n c\xf3 th\u1ec3 b\u1eaft ng\u01b0\u1eddi d\xf9ng thanh to\xe1n chi ph\xed \u0111\xf3. C\xe1ch ti\u1ebfp c\u1eadn sau c\xf3 kh\u1ea3 n\u0103ng m\u1edf r\u1ed9ng t\u1ed1t h\u01a1n v\xe0 \u0111\xf3 l\xe0 c\xe1ch m\xe0 b\u1ea1n s\u1ebd l\xe0m vi\u1ec7c trong su\u1ed1t h\u01b0\u1edbng d\u1eabn n\xe0y."]}),(0,c.jsx)(t.p,{children:"Sau khi x\xe1c nh\u1eadn xong m\xe0 kh\xf4ng c\xf3 v\u1ea5n \u0111\u1ec1 g\xec, b\u1ea1n s\u1ebd nh\u1eadn \u0111\u01b0\u1ee3c token object v\xe0 \u0111\u1ea3m b\u1ea3o r\u1eb1ng ch\u1ec9 ch\u1ee7 s\u1edf h\u1eefu m\u1edbi call method n\xe0y. Ch\u1ec9 ch\u1ee7 s\u1edf h\u1eefu m\u1edbi c\xf3 th\u1ec3 cho ph\xe9p c\xe1c account kh\xe1c transfer c\xe1c NFT c\u1ee7a h\u1ecd. Sau \u0111\xf3, b\u1ea1n nh\u1eadn \u0111\u01b0\u1ee3c next approval ID v\xe0 insert account \u0111\xe3 truy\u1ec1n v\xe0o trong map c\xf9ng v\u1edbi next approval ID. N\u1ebfu n\xf3 l\xe0 m\u1ed9t approval ID m\u1edbi, c\u1ea7n ph\u1ea3i thanh to\xe1n ph\xed cho storage. C\xf2n n\u1ebfu n\xf3 kh\xf4ng ph\u1ea3i l\xe0 m\u1ed9t approval ID m\u1edbi, kh\xf4ng c\u1ea7n ph\u1ea3i thanh to\xe1n ph\xed storage v\xe0 ch\u1ec9 \u0111\xednh k\xe8m 1 yoctoNEAR l\xe0 \u0111\u1ee7."}),(0,c.jsxs)(t.p,{children:["Sau \u0111\xf3, b\u1ea1n t\xednh to\xe1n l\u01b0\u1ee3ng storage \u0111ang \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng b\u1eb1ng c\xe1ch th\xeam account m\u1edbi \u0111\xf3 v\xe0o map v\xe0 t\u0103ng ",(0,c.jsx)(t.code,{children:"next_approval_id"})," c\u1ee7a token l\xean 1 \u0111\u01a1n v\u1ecb. Sau khi insert token object tr\u1edf l\u1ea1i map ",(0,c.jsx)(t.code,{children:"tokens_by_id"}),", b\u1ea1n ho\xe0n l\u1ea1i b\u1ea5t k\u1ef3 storage d\u01b0 th\u1eeba n\xe0o."]}),(0,c.jsxs)(t.p,{children:["B\u1ea1n s\u1ebd nh\u1eadn th\u1ea5y r\u1eb1ng function ch\u1ee9a m\u1ed9t tham s\u1ed1 t\xf9y ch\u1ecdn l\xe0 ",(0,c.jsx)(t.code,{children:"msg"}),". Tham s\u1ed1 n\xe0y th\u1ef1c ch\u1ea5t l\xe0 n\u1ec1n t\u1ea3ng c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c NFT marketplace tr\xean NEAR."]}),(0,c.jsx)(t.h4,{id:"marketplace-integrations",children:"T\xedch h\u1ee3p marketplace"}),(0,c.jsxs)(t.p,{children:["N\u1ebfu m\u1ed9t message \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o trong function, b\u1ea1n s\u1ebd ti\u1ebfn h\xe0nh m\u1ed9t cross contract call t\u1edbi account \u0111ang \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp. Cross contract call n\xe0y s\u1ebd g\u1ecdi function ",(0,c.jsx)(t.code,{children:"nft_on_approve"}),", function n\xe0y s\u1ebd parse message v\xe0 h\xe0nh \u0111\u1ed9ng t\u01b0\u01a1ng \u1ee9ng. H\xe3y xem m\u1ed9t tr\u01b0\u1eddng h\u1ee3p s\u1eed d\u1ee5ng hay g\u1eb7p."]}),(0,c.jsxs)(t.p,{children:["Ch\xfang ta c\xf3 m\u1ed9t marketplace v\u1edbi k\u1ef3 v\u1ecdng r\u1eb1ng c\xe1c \u0111i\u1ec1u ki\u1ec7n b\xe1n h\xe0ng c\u1ee7a n\xf3 s\u1ebd \u0111\u01b0\u1ee3c th\xf4ng qua message field. Benji ch\u1ea5p thu\u1eadn marketplace v\u1edbi function ",(0,c.jsx)(t.code,{children:"nft_approve"})," v\xe0 truy\u1ec1n m\u1ed9t JSON string \u0111\u1ec3 ph\xe1c th\u1ea3o c\xe1c \u0111i\u1ec1u ki\u1ec7n b\xe1n qua message. C\xe1c \u0111i\u1ec1u ki\u1ec7n b\xe1n h\xe0ng n\xe0y c\xf3 th\u1ec3 tr\xf4ng gi\u1ed1ng nh\u01b0 d\u01b0\u1edbi \u0111\xe2y:"]}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:"sale_conditions: {\n    price: 5\n}\n"})}),(0,c.jsxs)(t.p,{children:["B\u1eb1ng c\xe1ch \u0111\u1ec3 message field type ch\u1ec9 l\xe0 m\u1ed9t string, \u0111i\u1ec1u n\xe0y s\u1ebd t\u1ed5ng qu\xe1t h\xf3a quy tr\xecnh v\xe0 cho ph\xe9p user nh\u1eadp c\xe1c \u0111i\u1ec1u ki\u1ec7n b\xe1n h\xe0ng cho nhi\u1ec1u marketplace kh\xe1c nhau. Tuy thu\u1ed9c v\xe0o ng\u01b0\u1eddi ch\u1ea5p thu\u1eadn \u0111\u1ec3 truy\u1ec1n v\xe0o m\u1ed9t message th\xedch h\u1ee3p m\xe0 marketplace c\xf3 th\u1ec3 gi\u1ea3i m\xe3 v\xe0 s\u1eed d\u1ee5ng \u0111\xfang c\xe1ch. \u0110i\u1ec1u n\xe0y th\u01b0\u1eddng \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\xf4ng qua frontend app c\u1ee7a marketplace, \u1ee9ng d\u1ee5ng n\xe0y c\xf3 th\u1ec3 bi\u1ebft c\xe1ch c\u1ea5u tr\xfac ",(0,c.jsx)(t.code,{children:"msg"})," theo c\xe1ch h\u1eefu \xedch."]}),(0,c.jsx)(t.h4,{id:"c\xe1c-internal-function",children:"C\xe1c Internal function"}),(0,c.jsxs)(t.p,{children:["B\xe2y gi\u1edd, logic c\u1ed1t l\u1ed7i \u0111\u1ec3 ch\u1ea5p thu\u1eadn m\u1ed9t account \u0111\xe3 ho\xe0n t\u1ea5t, b\u1ea1n c\u1ea7n ti\u1ebfn h\xe0nh c\xe1c function ",(0,c.jsx)(t.code,{children:"assert_at_least_one_yocto"})," v\xe0 ",(0,c.jsx)(t.code,{children:"bytes_for_approved_account"}),". Di chuy\u1ec3n \u0111\u1ebfn file ",(0,c.jsx)(t.code,{children:"nft-contract/src/internal.rs"})," v\xe0 copy function d\u01b0\u1edbi \u0111\xe2y ngay b\xean d\u01b0\u1edbi function ",(0,c.jsx)(t.code,{children:"assert_one_yocto"}),"."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"52",end:"58",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/internal.rs"}),(0,c.jsx)(t.p,{children:"Ti\u1ebfp theo, b\u1ea1n s\u1ebd c\u1ea7n copy logic \u0111\u1ec3 t\xednh to\xe1n chi ph\xed \u0111\u1ec3 l\u01b0u tr\u1eef m\u1ed9t account ID l\xe0 bao nhi\xeau byte. \u0110\u1eb7t function n\xe0y \u1edf \u0111\u1ea7u trang:"}),(0,c.jsx)(r.Ey,{language:"rust",start:"1",end:"9",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/internal.rs"}),(0,c.jsx)(t.p,{children:"B\xe2y gi\u1edd, logic \u0111\u1ec3 approve account \u0111\xe3 ho\xe0n th\xe0nh, b\u1ea1n c\u1ea7n thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer."}),(0,c.jsx)(t.h3,{id:"thay-\u0111\u1ed5i-c\xe1c-h\u1ea1n-ch\u1ebf-cho-vi\u1ec7c-transfer-c\xe1c-nft",children:"Thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer c\xe1c NFT"}),(0,c.jsxs)(t.p,{children:["Hi\u1ec7n t\u1ea1i, m\u1ed9t NFT ",(0,c.jsx)(t.strong,{children:"ch\u1ec9"})," c\xf3 th\u1ec3 transfer b\u1edfi ng\u01b0\u1eddi s\u1edf h\u1eefu n\xf3. B\u1ea1n c\u1ea7n thay \u0111\u1ed5i h\u1ea1n ch\u1ebf \u0111\xf3 \u0111\u1ec3 nh\u1eefng ng\u01b0\u1eddi \u0111\xe3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn c\u0169ng c\xf3 th\u1ec3 transfer c\xe1c NFT. Ngo\xe0i ra, b\u1ea1n s\u1ebd l\xe0m \u0111i\u1ec1u \u0111\xf3 \u0111\u1ec3 n\u1ebfu m\u1ed9t approval ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o, b\u1ea1n c\xf3 th\u1ec3 t\u0103ng c\u01b0\u1eddng security v\xe0 ki\u1ec3m tra n\u1ebfu c\u1ea3 hai account \u0111ang c\u1ed1 g\u1eafng transfer c\xf3 n\u1eb1m trong approve list hay kh\xf4ng ",(0,c.jsx)(t.strong,{children:"v\xe0"})," ch\xfang t\u01b0\u01a1ng \u1ee9ng \u0111\xfang v\u1edbi approval ID. \u0110i\u1ec1u n\xe0y l\xe0 \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 m\xe0 ch\xfang ta \u0111\xe3 g\u1eb7p ph\u1ea3i tr\u01b0\u1edbc \u0111\xf3."]}),(0,c.jsxs)(t.p,{children:["Trong file ",(0,c.jsx)(t.code,{children:"internal.rs"}),", b\u1ea1n c\u1ea7n thay \u0111\u1ed5i logic c\u1ee7a method ",(0,c.jsx)(t.code,{children:"internal_transfer"})," v\xec \u0111\xf3 l\xe0 n\u01a1i m\xe0 c\xe1c h\u1ea1n ch\u1ebf \u0111ang \u0111\u01b0\u1ee3c t\u1ea1o ra. Thay \u0111\u1ed5i internal transfer function th\xe0nh nh\u01b0 sau:"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"135",end:"201",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/internal.rs"}),(0,c.jsx)(t.p,{children:"Vi\u1ec7c n\xe0y s\u1ebd ki\u1ec3m tra xem ng\u01b0\u1eddi g\u1eedi c\xf3 ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu hay kh\xf4ng v\xe0 sau \u0111\xf3 n\u1ebfu h\u1ecd kh\xf4ng ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu, n\xf3 s\u1ebd ki\u1ec3m tra ng\u01b0\u1eddi g\u1eedi c\xf3 trong approval list hay kh\xf4ng. N\u1ebfu m\u1ed9t approve ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o function, n\xf3 s\u1ebd ki\u1ec3m tra approval ID th\u1ef1c t\u1ebf c\u1ee7a ng\u01b0\u1eddi g\u1eedi \u0111\xe3 \u0111\u01b0\u1ee3c l\u1eefu tr\u1eef tr\xean contract c\xf3 kh\u1edbp v\u1edbi approve ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o hay kh\xf4ng."}),(0,c.jsx)(t.h4,{id:"ho\xe0n-tr\u1ea3-storage-khi-transfer",children:"Ho\xe0n tr\u1ea3 storage khi transfer"}),(0,c.jsxs)(t.p,{children:["Trong khi b\u1ea1n \u0111ang \u1edf internal file, b\u1ea1n s\u1ebd c\u1ea7n th\xeam c\xe1c method \u0111\u1ec3 ho\xe0n l\u1ea1i ti\u1ec1n cho user \u0111\xe3 tr\u1ea3 cho vi\u1ec7c l\u01b0u tr\u1eef c\xe1c approve account tr\xean contract khi m\u1ed9t NFT \u0111\u01b0\u1ee3c transfer. B\u1edfi v\xec b\u1ea1n s\u1ebd x\xf3a map ",(0,c.jsx)(t.code,{children:"approved_account_ids"})," b\u1ea5t c\u1ee9 khi n\xe0o c\xe1c NFT \u0111\xe3 \u0111\u01b0\u1ee3c transfer v\xe0 storage kh\xf4ng c\xf2n \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng n\u1eefa."]}),(0,c.jsxs)(t.p,{children:["Ngay b\xean d\u01b0\u1edbi function ",(0,c.jsx)(t.code,{children:"bytes_for_approved_account_id"}),", copy hai function b\xean d\u01b0\u1edbi:"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"11",end:"32",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/internal.rs"}),(0,c.jsxs)(t.p,{children:["Vi\u1ec7c n\xe0y s\u1ebd h\u1eefu \xedch trong ph\u1ea7n ti\u1ebfp theo, n\u01a1i b\u1ea1n s\u1ebd thay \u0111\u1ed5i function ",(0,c.jsx)(t.code,{children:"nft_core"})," \u0111\u1ec3 th\xeam v\xe0o logic approval m\u1edbi."]}),(0,c.jsxs)(t.h3,{id:"c\xe1c-thay-\u0111\u1ed5i-v\u1edbi-nft_corers",children:["C\xe1c thay \u0111\u1ed5i v\u1edbi ",(0,c.jsx)(t.code,{children:"nft_core.rs"})]}),(0,c.jsxs)(t.p,{children:["\u0110i t\u1edbi file ",(0,c.jsx)(t.code,{children:"nft-contract/src/nft_core.rs"})," v\xe0 thay \u0111\u1ed5i \u0111\u1ea7u ti\xean m\xe0 b\u1ea1n mu\u1ed1n th\u1ef1c hi\u1ec7n l\xe0 th\xeam m\u1ed9t ",(0,c.jsx)(t.code,{children:"approval_id"})," t\u1edbi c\u1ea3 hai function ",(0,c.jsx)(t.code,{children:"nft_transfer"})," v\xe0 ",(0,c.jsx)(t.code,{children:"nft_transfer_call"}),". Vi\u1ec7c n\xe0y \u0111\u1ec3 b\u1ea5t k\u1ef3 ai kh\xf4ng ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu \u0111ang c\u1ed1 g\u1eafng transfer token, ph\u1ea3i truy\u1ec1n v\xe0o m\u1ed9t approval ID \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 \u0111\xe3 th\u1ea5y tr\u01b0\u1edbc \u0111\xf3. N\u1ebfu h\u1ecd l\xe0 ch\u1ee7 s\u1edf h\u1eefu, approval ID s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng nh\u01b0 ch\xfang ta \u0111\xe3 th\u1ea5y trong function ",(0,c.jsx)(t.code,{children:"internal_transfer"}),"."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"8",end:"29",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsxs)(t.p,{children:["Sau \u0111\xf3, b\u1ea1n s\u1ebd c\u1ea7n th\xeam m\u1ed9t map ",(0,c.jsx)(t.code,{children:"approved_account_ids"})," t\u1edbi c\xe1c tham s\u1ed1 c\u1ee7a ",(0,c.jsx)(t.code,{children:"nft_resolve_transfer"}),". Vi\u1ec7c n\xe0y \u0111\u1ec3 b\u1ea1n c\xf3 th\u1ec3 ho\xe0n l\u1ea1i ti\u1ec1n cho c\xe1c account n\u1ebfu vi\u1ec7c transfer di\u1ec5n ra b\xecnh th\u01b0\u1eddng."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"47",end:"62",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsxs)(t.p,{children:["Chuy\u1ec3n sang ",(0,c.jsx)(t.code,{children:"nft_transfer"}),", thay \u0111\u1ed5i duy nh\u1ea5t m\xe0 b\u1ea1n c\u1ea7n th\u1ef1c hi\u1ec7n l\xe0 truy\u1ec1n approval ID v\xe0o function ",(0,c.jsx)(t.code,{children:"internal_transfer"})," v\xe0 sau \u0111\xf3 tr\u1ea3 l\u1ea1i c\xe1c approve account ID c\u1ee7a c\xe1c token tr\u01b0\u1edbc \u0111\xf3 sau khi qu\xe1 tr\xecnh transfer \u0111\xe3 k\u1ebft th\xfac"]}),(0,c.jsx)(r.Ey,{language:"rust",start:"67",end:"96",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsxs)(t.p,{children:["Next, you need to do the same to ",(0,c.jsx)(t.code,{children:"nft_transfer_call"})," but instead of refunding immediately, you need to attach the previous token's approved account IDs to ",(0,c.jsx)(t.code,{children:"nft_resolve_transfer"})," instead as there's still the possibility that the transfer gets reverted."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"98",end:"145",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsxs)(t.p,{children:["B\u1ea1n c\u0169ng c\u1ea7n th\xeam c\xe1c approve account ID c\u1ee7a c\xe1c token v\xe0o ",(0,c.jsx)(t.code,{children:"JsonToken"})," \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 b\u1edfi ",(0,c.jsx)(t.code,{children:"nft_token"}),"."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"147",end:"163",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsxs)(t.p,{children:["Cu\u1ed1i c\xf9ng, b\u1ea1n c\u1ea7n th\xeam logic \u0111\u1ec3 ho\xe0n tr\u1ea3 c\xe1c approve account ID trong ",(0,c.jsx)(t.code,{children:"nft_resolve_transfer"}),". N\u1ebfu qu\xe1 tr\xecnh transfer th\xe0nh c\xf4ng, b\u1ea1n n\xean ho\xe0n l\u1ea1i ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec \u0111\xe3 gi\u1ea3i ph\xf3ng storage b\u1edfi reset field ",(0,c.jsx)(t.code,{children:"approved_account_ids"})," c\u1ee7a c\xe1c token. Tuy nhi\xean, b\u1ea1n n\xean revert qu\xe1 tr\xecnh transfer n\u1ebfu kh\xf4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 ho\xe0n l\u1ea1i cho b\u1ea5t k\u1ef3 ai. V\xec ng\u01b0\u1eddi nh\u1eadn \u0111\xe3 s\u1edf h\u1eefu token, h\u1ecd c\xf3 th\u1ec3 \u0111\xe3 th\xeam c\xe1c approve account ID c\u1ee7a ri\xeang m\xecnh v\xe0 v\xec v\u1eady b\u1ea1n n\xean ho\xe0n l\u1ea1i ti\u1ec1n cho ng\u01b0\u1eddi g\u1eedi n\u1ebfu ng\u01b0\u1eddi nh\u1eadn \u0111\xe3 l\xe0m v\u1eady."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"168",end:"234",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/nft_core.rs"}),(0,c.jsx)(t.p,{children:"V\u1edbi vi\u1ec7c ho\xe0n th\xe0nh \u0111i\u1ec1u \u0111\xf3, \u0111\xe3 \u0111\u1ebfn l\xfac ti\u1ebfp t\u1ee5c v\xe0 ho\xe0n th\xe0nh nhi\u1ec7m v\u1ee5 ti\u1ebfp theo."}),(0,c.jsx)(t.h2,{id:"ki\u1ec3m-tra-m\u1ed9t-account-\u0111\u01b0\u1ee3c-ch\u1ea5p-thu\u1eadn-hay-kh\xf4ng",children:"Ki\u1ec3m tra m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng"}),(0,c.jsx)(t.p,{children:"Gi\u1edd \u0111\xe2y, logic c\u1ed1t l\xf5i \u0111\xe3 \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng cho ch\u1ea5p thu\u1eadn v\xe0 ho\xe0n ti\u1ec1n cho c\xe1c account, n\xean k\u1ec3 t\u1eeb th\u1eddi \u0111i\u1ec3m n\xe0y tr\u1edf \u0111i m\u1ecdi vi\u1ec7c s\u1ebd di\u1ec5n ra su\xf4n s\u1ebb. B\xe2y gi\u1edd b\u1ea1n c\u1ea7n tri\u1ec3n khai logic \u0111\u1ec3 ki\u1ec3m tra xem m\u1ed9t account \u0111\xe3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay ch\u01b0a. Vi\u1ec7c n\xe0y c\u1ea7n m\u1ed9t account v\xe0 token ID c\u0169ng nh\u01b0 m\u1ed9t t\xf9y ch\u1ecdn approval ID. N\u1ebfu approval ID kh\xf4ng \u0111\u01b0\u1ee3c cung c\u1ea5p, n\xf3 \u0111\u01a1n gi\u1ea3n tr\u1ea3 v\u1ec1 vi\u1ec7c account c\xf3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng."}),(0,c.jsxs)(t.p,{children:["N\u1ebfu m\u1ed9t approval ID \u0111\u01b0\u1ee3c cung c\u1ea5p, n\xf3 s\u1ebd tr\u1ea3 v\u1ec1 vi\u1ec7c account c\xf3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn v\xe0 c\xf3 c\xf9ng approval ID v\u1edbi account \u0111\xe3 cung c\u1ea5p hay kh\xf4ng. Let's move to the ",(0,c.jsx)(t.code,{children:"nft-contract/src/approval.rs"})," file and add the necessary logic to the ",(0,c.jsx)(t.code,{children:"nft_is_approved"})," function."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"98",end:"125",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/approval.rs"}),(0,c.jsx)(t.p,{children:"B\xe2y gi\u1edd ch\xfang ta h\xe3y ti\u1ebfp t\u1ee5c v\xe0 th\xeam logic \u0111\u1ec3 thu h\u1ed3i account"}),(0,c.jsx)(t.h2,{id:"thu-h\u1ed3i-account",children:"Thu h\u1ed3i account"}),(0,c.jsx)(t.p,{children:"B\u01b0\u1edbc ti\u1ebfp theo trong h\u01b0\u1edbng d\u1eabn n\xe0y l\xe0 cho ph\xe9p ng\u01b0\u1eddi d\xf9ng thu h\u1ed3i m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh kh\u1ecfi quy\u1ec1n truy c\u1eadp NFT c\u1ee7a h\u1ecd. \u0110i\u1ec1u \u0111\u1ea7u ti\xean b\u1ea1n s\u1ebd mu\u1ed1n l\xe0m l\xe0 y\xeau c\u1ea7u m\u1ed9t yocto cho m\u1ee5c \u0111\xedch security. Sau \u0111\xf3 b\u1ea1n c\u1ea7n \u0111\u1ea3m b\u1ea3o r\u1eb1ng ng\u01b0\u1eddi g\u1ecdi l\xe0 ch\u1ee7 s\u1edf h\u1eefu c\u1ee7a token. N\u1ebfu nh\u1eefng \u0111i\u1ec1u \u0111\xf3 \u0111\u1ec1u \u0111\u01b0\u1ee3c \u0111\xe1p \u1ee9ng, b\u1ea1n s\u1ebd c\u1ea7n x\xf3a account \u0111\xe3 truy\u1ec1n v\xe0o kh\u1ecfi c\xe1c approve account ID c\u1ee7a c\xe1c token v\xe0 ho\xe0n l\u1ea1i ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec storage \u0111\u01b0\u1ee3c gi\u1ea3i ph\xf3ng."}),(0,c.jsx)(r.Ey,{language:"rust",start:"127",end:"151",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/approval.rs"}),(0,c.jsx)(t.h2,{id:"thu-h\u1ed3i-to\xe0n-b\u1ed9-c\xe1c-account",children:"Thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account"}),(0,c.jsxs)(t.p,{children:["B\u01b0\u1edbc cu\u1ed1i c\xf9ng trong h\u01b0\u1edbng d\u1eabn n\xe0y l\xe0 cho ph\xe9p user thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account kh\u1ecfi quy\u1ec1n truy c\u1eadp NFT c\u1ee7a h\u1ecd. Vi\u1ec7c n\xe0y c\u0169ng y\xeau c\u1ea7u m\u1ed9t yocto cho m\u1ee5c \u0111\u1ecbch security v\xe0 \u0111\u1ea3m b\u1ea3o r\u1eb1ng ng\u01b0\u1eddi g\u1ecdi l\xe0 ch\u1ee7 s\u1edf h\u1eefu c\u1ee7a token. Sau \u0111\xf3 b\u1ea1n ho\xe0n ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec \u0111\xe3 gi\u1ea3i ph\xf3ng to\xe0n b\u1ed9 c\xe1c account trong map v\xe0 sau \u0111\xf3 l\xe0 x\xf3a ",(0,c.jsx)(t.code,{children:"approved_account_ids"}),"."]}),(0,c.jsx)(r.Ey,{language:"rust",start:"153",end:"174",url:"https://github.com/near-examples/nft-tutorial/blob/5.approval/nft-contract/src/approval.rs"}),(0,c.jsx)(t.p,{children:"V\u1edbi vi\u1ec7c ho\xe0n th\xe0nh \u0111i\u1ec1u \u0111\xf3, b\xe2y gi\u1edd l\xe0 l\xfac \u0111\u1ec3 deploy v\xe0 b\u1eaft \u0111\u1ea7u qu\xe1 tr\xecnh test contract."}),(0,c.jsx)(t.h2,{id:"testing-changes",children:"Test c\xe1c thay \u0111\u1ed5i m\u1edbi"}),(0,c.jsx)(t.p,{children:"V\xec nh\u1eefng thay \u0111\u1ed5i n\xe0y \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn t\u1ea5t c\u1ea3 c\xe1c token kh\xe1c v\xe0 state s\u1ebd kh\xf4ng th\u1ec3 t\u1ef1 \u0111\u1ed9ng \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb code m\u1edbi, ch\u1ec9 redeploy contract s\u1ebd d\u1eabn \u0111\u1ebfn l\u1ed7i. For this reason, it's best practice to create a new account and deploy the contract there."}),(0,c.jsx)(t.h3,{id:"deployment",children:"Deployment"}),(0,c.jsx)(t.p,{children:"Next, you'll deploy this contract to the network."}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"export APPROVAL_NFT_CONTRACT_ID=<accountId>\nnear create-account $APPROVAL_NFT_CONTRACT_ID --useFaucet\n"})}),(0,c.jsx)(t.p,{children:"S\u1eed d\u1ee5ng build script, deploy contract nh\u01b0 b\u1ea1n \u0111\xe3 l\xe0m \u1edf c\xe1c h\u01b0\u1edbng d\u1eabn tr\u01b0\u1edbc:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"yarn build && near deploy $APPROVAL_NFT_CONTRACT_ID out/main.wasm\n"})}),(0,c.jsx)(t.h3,{id:"initialization-and-minting",children:"Kh\u1edfi t\u1ea1o v\xe0 mint"}),(0,c.jsx)(t.p,{children:"V\xec \u0111\xe2y l\xe0 m\u1ed9t contract m\u1edbi, b\u1ea1n s\u1ebd c\u1ea7n ph\u1ea3i kh\u1edfi t\u1ea1o v\xe0 mint m\u1ed9t token. S\u1eed d\u1ee5ng command d\u01b0\u1edbi \u0111\xe2y \u0111\u1ec3 kh\u1edfi t\u1ea1o contract:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"near call $APPROVAL_NFT_CONTRACT_ID new_default_meta '{\"owner_id\": \"'$APPROVAL_NFT_CONTRACT_ID'\"}' --accountId $APPROVAL_NFT_CONTRACT_ID\n"})}),(0,c.jsxs)(t.p,{children:["Ti\u1ebfp theo, b\u1ea1n s\u1ebd c\u1ea7n mint m\u1ed9t token. B\u1eb1ng c\xe1ch ch\u1ea1y command n\xe0y, b\u1ea1n s\u1ebd mint m\u1ed9t token v\u1edbi token ID ",(0,c.jsx)(t.code,{children:'"approval-token"'})," v\xe0 ng\u01b0\u1eddi nh\u1eadn s\u1ebd l\xe0 account m\u1edbi c\u1ee7a b\u1ea1n."]}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near call $APPROVAL_NFT_CONTRACT_ID nft_mint \'{"token_id": "approval-token", "metadata": {"title": "Approval Token", "description": "testing out the new approval extension of the standard", "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif"}, "receiver_id": "\'$APPROVAL_NFT_CONTRACT_ID\'"}\' --accountId $APPROVAL_NFT_CONTRACT_ID --amount 0.1\n'})}),(0,c.jsx)(t.p,{children:"B\u1ea1n c\xf3 th\u1ec3 ki\u1ec3m tra xem m\u1ecdi th\u1ee9 c\xf3 di\u1ec5n ra b\xecnh th\u01b0\u1eddng hay kh\xf4ng b\u1eb1ng c\xe1ch g\u1ecdi m\u1ed9t trong c\xe1c enumeration function:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near view $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner \'{"account_id": "\'$APPROVAL_NFT_CONTRACT_ID\'", "limit": 10}\'\n'})}),(0,c.jsx)(t.p,{children:"N\xf3 s\u1ebd tr\u1ea3 v\u1ec1 m\u1ed9t output tr\xf4ng gi\u1ed1ng nh\u01b0 sau:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "approval.goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": {}\n  }\n]\n'})}),(0,c.jsx)(t.p,{children:"L\u01b0u \xfd r\u1eb1ng c\xe1c approve account ID b\xe2y gi\u1edd \u0111ang \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 t\u1eeb function nh\u01b0 th\u1ebf n\xe0o? \u0110\xe2y l\xe0 m\u1ed9t d\u1ea5u hi\u1ec7u tuy\u1ec7t v\u1eddi! B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 s\u1eb5n s\xe0ng \u0111\u1ec3 ti\u1ebfp t\u1ee5c v\xe0 ch\u1ea5p thu\u1eadn m\u1ed9t account c\xf3 quy\u1ec1n truy c\u1eadp t\u1edbi token c\u1ee7a m\xecnh."}),(0,c.jsx)(t.h3,{id:"approving-an-account",children:"Ch\u1ea5p thu\u1eadn m\u1ed9t account"}),(0,c.jsxs)(t.p,{children:["T\u1ea1i th\u1eddi \u0111i\u1ec3m n\xe0y, b\u1ea1n s\u1ebd c\xf3 hai account. M\u1ed9t \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong ",(0,c.jsx)(t.code,{children:"$NFT_CONTRACT_ID"})," v\xe0 m\u1ed9t c\xe1i kh\xe1c trong environment variable l\xe0 ",(0,c.jsx)(t.code,{children:"$APPROVAL_NFT_CONTRACT_ID"}),". B\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng c\u1ea3 hai account \u0111\u1ec3 test m\u1ecdi th\u1ee9. N\u1ebfu b\u1ea1n ch\u1ea5p thu\u1eadn account c\u0169 c\u1ee7a m\xecnh, n\xf3 s\u1ebd c\xf3 kh\u1ea3 n\u0103ng transfer NFT t\u1edbi ch\xednh n\xf3."]}),(0,c.jsxs)(t.p,{children:["Ch\u1ea1y command d\u01b0\u1edbi \u0111\xe2y \u0111\u1ec3 ch\u1ea5p thu\u1eadn account \u0111\xe3 l\u01b0u tr\u1eef trong ",(0,c.jsx)(t.code,{children:"$NFT_CONTRACT_ID"})," c\xf3 quy\u1ec1n truy c\u1eadp \u0111\u1ec3 transfer NFT c\u1ee7a b\u1ea1n v\u1edbi m\u1ed9t ID ",(0,c.jsx)(t.code,{children:'"approval-token"'}),". B\u1ea1n kh\xf4ng c\u1ea7n truy\u1ec1n m\u1ed9t message b\u1edfi v\xec account c\u0169 kh\xf4ng ti\u1ebfn h\xe0nh function ",(0,c.jsx)(t.code,{children:"nft_on_approve"}),". Ngo\xe0i ra, b\u1ea1n s\u1ebd c\u1ea7n \u0111\xednh k\xe8m \u0111\u1ee7 NEAR \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o chi ph\xed l\u01b0u tr\u1eef account tr\xean contract. 0.1 NEAR s\u1ebd l\xe0 qu\xe1 \u0111\u1ee7 v\xe0 b\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c ho\xe0n l\u1ea1i b\u1ea5t k\u1ef3 ph\u1ea7n d\u01b0 th\u1eeba kh\xf4ng s\u1eed d\u1ee5ng."]}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near call $APPROVAL_NFT_CONTRACT_ID nft_approve \'{"token_id": "approval-token", "account_id": "\'$NFT_CONTRACT_ID\'"}\' --accountId $APPROVAL_NFT_CONTRACT_ID --deposit 0.1\n'})}),(0,c.jsx)(t.p,{children:"N\u1ebfu b\u1ea1n g\u1ecdi c\xf9ng enumeration method nh\u01b0 tr\u01b0\u1edbc \u0111\xf3, b\u1ea1n s\u1ebd nh\xecn th\u1ea5y approve account ID m\u1edbi \u0111\u01b0\u1ee3c tr\u1ea3 l\u1ea1i."}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near view $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner \'{"account_id": "\'$APPROVAL_NFT_CONTRACT_ID\'", "limit": 10}\'\n'})}),(0,c.jsx)(t.p,{children:"N\xf3 s\u1ebd tr\u1ea3 v\u1ec1 m\u1ed9t output trong gi\u1ed1ng nh\u01b0 sau:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "approval.goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": { "goteam.examples.testnet": 0 }\n  }\n]\n'})}),(0,c.jsx)(t.h3,{id:"transferring-the-nft",children:"Transfer NFT b\u1eb1ng m\u1ed9t approve account"}),(0,c.jsx)(t.p,{children:"B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 ch\u1ea5p thu\u1eadn account kh\xe1c \u0111\u1ec3 transfer token, b\u1ea1n c\xf3 th\u1ec3 test h\xe0nh \u0111\u1ed9ng \u0111\xf3. B\u1ea1n s\u1ebd c\xf3 th\u1ec3 s\u1eed d\u1ee5ng account kh\xe1c \u0111\u1ec3 transfer NFT sang ch\xednh n\xf3, b\u1eb1ng c\xe1ch \u0111\u1eb7t l\u1ea1i c\xe1c approve account ID. H\xe3y test vi\u1ec7c transfer NFT v\u1edbi m\u1ed9t approval ID kh\xf4ng \u0111\xfang:"}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near call $APPROVAL_NFT_CONTRACT_ID nft_transfer \'{"receiver_id": "\'$NFT_CONTRACT_ID\'", "token_id": "approval-token", "approval_id": 1}\' --accountId $NFT_CONTRACT_ID --depositYocto 1\n'})}),(0,c.jsxs)(e,{children:[(0,c.jsx)("summary",{children:"V\xed d\u1ee5 k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1: "}),(0,c.jsx)("p",{children:(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:"kind: {\n    ExecutionError: \"Smart contract panicked: panicked at 'assertion failed: `(left == right)`\\n\" +\n      '  left: `0`,\\n' +\n      \" right: `1`: The actual approval_id 0 is different from the given approval_id 1', src/internal.rs:165:17\"\n  },\n"})})})]}),(0,c.jsxs)(t.p,{children:["N\u1ebfu b\u1ea1n truy\u1ec1n v\xe0o approval ID ch\xednh x\xe1c l\xe0 ",(0,c.jsx)(t.code,{children:"0"}),", m\u1ecdi th\u1ee9 s\u1ebd ho\u1ea1t \u0111\u1ed9ng t\u1ed1t."]}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near call $APPROVAL_NFT_CONTRACT_ID nft_transfer \'{"receiver_id": "\'$NFT_CONTRACT_ID\'", "token_id": "approval-token", "approval_id": 0}\' --accountId $NFT_CONTRACT_ID --depositYocto 1\n'})}),(0,c.jsx)(t.p,{children:"N\u1ebfu b\u1ea1n g\u1ecdi enumeration method m\u1ed9t l\u1ea7n n\u1eefa, b\u1ea1n s\u1ebd nh\xecn th\u1ea5y ch\u1ee7 s\u1edf h\u1eefu \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt v\xe0 c\xe1c approve account ID \u0111\u01b0\u1ee3c \u0111\u1eb7t l\u1ea1i."}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": {}\n  }\n]\n'})}),(0,c.jsx)(t.p,{children:"B\xe2y gi\u1edd ch\xfang ta h\xe3y test approval ID t\u0103ng d\u1ea7n tr\xean c\xe1c ch\u1ee7 s\u1edf h\u1eefu kh\xe1c nhau. If you approve the account that originally minted the token, the approval ID should be 1 now."}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near call $APPROVAL_NFT_CONTRACT_ID nft_approve \'{"token_id": "approval-token", "account_id": "\'$APPROVAL_NFT_CONTRACT_ID\'"}\' --accountId $NFT_CONTRACT_ID --deposit 0.1\n'})}),(0,c.jsx)(t.p,{children:"Calling the view function again show now return an approval ID of 1 for the account that was approved."}),(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-bash",children:'near view $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner \'{"account_id": "\'$NFT_CONTRACT_ID\'", "limit": 10}\'\n'})}),(0,c.jsxs)(e,{children:[(0,c.jsx)("summary",{children:"V\xed d\u1ee5 k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1: "}),(0,c.jsx)("p",{children:(0,c.jsx)(t.pre,{children:(0,c.jsx)(t.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": { "approval.goteam.examples.testnet": 1 }\n  }\n]\n'})})})]}),(0,c.jsx)(t.p,{children:"V\u1edbi b\xe0i test \u0111\xe3 k\u1ebft th\xfac, b\u1ea1n \u0111\xe3 tri\u1ec3n khai th\xe0nh c\xf4ng approval extension theo ti\xeau chu\u1ea9n!"}),(0,c.jsx)(t.h2,{id:"t\u1ed5ng-k\u1ebft",children:"T\u1ed5ng k\u1ebft"}),(0,c.jsxs)(t.p,{children:["Today you went through a lot of logic to implement the ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"approvals extension"})," so let's break down exactly what you did."]}),(0,c.jsxs)(t.p,{children:["\u0110\u1ea7u ti\xean, b\u1ea1n kh\xe1m ph\xe1 ",(0,c.jsx)(t.a,{href:"#basic-solution",children:"c\xe1ch ti\u1ebfp c\u1eadn c\u01a1 b\u1ea3n"})," c\u1ee7a vi\u1ec7c l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1. Sau \u0111\xf3, b\u1ea1n \u0111\xe3 xem qua v\xe0 ph\xe1t hi\u1ec7n m\u1ed9t s\u1ed1 ",(0,c.jsx)(t.a,{href:"#the-problem",children:"v\u1ea5n \u0111\u1ec1"})," v\u1edbi gi\u1ea3i ph\xe1p \u0111\xf3 v\xe0 t\xecm hi\u1ec3u c\xe1ch ",(0,c.jsx)(t.a,{href:"#the-solution",children:"kh\u1eafc ph\u1ee5c n\xf3"}),"."]}),(0,c.jsxs)(t.p,{children:["Sau khi hi\u1ec3u nh\u1eefng g\xec b\u1ea1n n\xean l\xe0m \u0111\u1ec3 tri\u1ec3n khai approval extension, b\u1ea1n b\u1eaft \u0111\u1ea7u ",(0,c.jsx)(t.a,{href:"#expanding-json-and-token",children:"s\u1eeda \u0111\u1ed5i"})," JsonToken v\xe0 c\xe1c c\u1ea5u tr\xfac Token trong contract. Sau \u0111\xf3 b\u1ea1n \u0111\xe3 ti\u1ebfn h\xe0nh logic ",(0,c.jsx)(t.a,{href:"#approving-accounts",children:"ch\u1ea5p thu\u1eadn c\xe1c account"})," v\xe0 xem c\xe1ch t\xedch h\u1ee3p ",(0,c.jsx)(t.a,{href:"#marketplace-integrations",children:"c\xe1c marketplace"}),"."]}),(0,c.jsxs)(t.p,{children:["Sau khi tri\u1ec3n khai logic \u0111\u1eb1ng sau vi\u1ec7c ch\u1ea5p thu\u1eadn account, b\u1ea1n \u0111\xe3 th\u1ef1c hi\u1ec7n v\xe0 ",(0,c.jsx)(t.a,{href:"#changed-restrictions",children:"thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf "})," c\u1ea7n thi\u1ebft \u0111\u1ec3 transfer NFT. B\u01b0\u1edbc cu\u1ed1i c\xf9ng b\u1ea1n \u0111\xe3 l\xe0m \u0111\u1ec3 k\u1ebft th\xfac logic ch\u1ea5p thu\u1eadn l\xe0 quay tr\u1edf l\u1ea1i v\xe0 c\u1eadp nh\u1eadt file ",(0,c.jsx)(t.a,{href:"#nft-core-changes",children:"nft_core"})," \u0111\u1ec3 t\u01b0\u01a1ng t\xedch v\u1edbi nh\u1eefng thay \u0111\u1ed5i m\u1edbi."]}),(0,c.jsxs)(t.p,{children:["At this point, everything was implemented in order to allow accounts to be approved and you extended the functionality of the ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Core",children:"core standard"})," to allow for approved accounts to transfer tokens."]}),(0,c.jsxs)(t.p,{children:["B\u1ea1n \u0111\xe3 ti\u1ebfn h\xe0nh m\u1ed9t view method \u0111\u1ec3 ",(0,c.jsx)(t.a,{href:"#check-if-account-approved",children:"ki\u1ec3m tra"})," m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng v\xe0 \u0111\u1ec3 ho\xe0n th\xe0nh ph\u1ea7n code c\u1ee7a h\u01b0\u1edbng d\u1eabn, b\u1ea1n \u0111\xe3 tri\u1ec3n khai logic c\u1ea7n thi\u1ebft \u0111\u1ec3 ",(0,c.jsx)(t.a,{href:"#revoke-account",children:"thu h\u1ed3i account"})," c\u0169ng nh\u01b0 l\xe0 ",(0,c.jsx)(t.a,{href:"#revoke-all-accounts",children:"thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account"}),"."]}),(0,c.jsxs)(t.p,{children:["After this, the contract code was finished and it was time to move onto testing where you created an ",(0,c.jsx)(t.a,{href:"#deployment",children:"account"})," and tested the ",(0,c.jsx)(t.a,{href:"#approving-an-account",children:"approving"})," and ",(0,c.jsx)(t.a,{href:"#transferring-the-nft",children:"transferring"})," for your NFTs."]}),(0,c.jsx)(t.p,{children:"Trong h\u01b0\u1edbng d\u1eabn ti\u1ebfp theo, b\u1ea1n s\u1ebd h\u1ecdc v\u1ec1 c\xe1c ti\xeau chu\u1ea9n royalty v\xe0 l\xe0m c\xe1ch n\xe0o b\u1ea1n c\xf3 th\u1ec3 t\u01b0\u01a1ng t\xe1c \u0111\u01b0\u1ee3c v\u1edbi c\xe1c NFT marketplace."}),(0,c.jsxs)(t.admonition,{title:"Versioning for this article",type:"note",children:[(0,c.jsx)(t.p,{children:"At the time of this writing, this example works with the following versions:"}),(0,c.jsxs)(t.ul,{children:["\n",(0,c.jsxs)(t.li,{children:["near-cli: ",(0,c.jsx)(t.code,{children:"4.0.4"})]}),"\n",(0,c.jsxs)(t.li,{children:["NFT standard: ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Core",children:"NEP171"}),", version ",(0,c.jsx)(t.code,{children:"1.1.0"})]}),"\n",(0,c.jsxs)(t.li,{children:["Enumeration standard: ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Enumeration",children:"NEP181"}),", version ",(0,c.jsx)(t.code,{children:"1.0.0"})]}),"\n",(0,c.jsxs)(t.li,{children:["Approval standard: ",(0,c.jsx)(t.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"NEP178"}),", version ",(0,c.jsx)(t.code,{children:"1.1.0"})]}),"\n"]})]})]})]})}function p(n={}){const{wrapper:t}={...(0,a.a)(),...n.components};return t?(0,c.jsx)(t,{...n,children:(0,c.jsx)(u,{...n})}):u(n)}},85162:(n,t,e)=>{e.d(t,{Z:()=>i});e(67294);var c=e(36905);const a={tabItem:"tabItem_Ymn6"};var r=e(85893);function i(n){var t=n.children,e=n.hidden,i=n.className;return(0,r.jsx)("div",{role:"tabpanel",className:(0,c.Z)(a.tabItem,i),hidden:e,children:t})}},74866:(n,t,e)=>{e.d(t,{Z:()=>j});var c=e(67294),a=e(36905),r=e(12466),i=e(16550),o=e(20469),h=e(91980),s=e(67392),l=e(50012);function u(n){var t,e;return null!=(t=null==(e=c.Children.toArray(n).filter((function(n){return"\n"!==n})).map((function(n){if(!n||(0,c.isValidElement)(n)&&((t=n.props)&&"object"==typeof t&&"value"in t))return n;var t;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof n.type?n.type:n.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:e.filter(Boolean))?t:[]}function p(n){var t=n.values,e=n.children;return(0,c.useMemo)((function(){var n=null!=t?t:function(n){return u(n).map((function(n){var t=n.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}(e);return function(n){var t=(0,s.l)(n,(function(n,t){return n.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(n){return n.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(n),n}),[t,e])}function d(n){var t=n.value;return n.tabValues.some((function(n){return n.value===t}))}function g(n){var t=n.queryString,e=void 0!==t&&t,a=n.groupId,r=(0,i.k6)(),o=function(n){var t=n.queryString,e=void 0!==t&&t,c=n.groupId;if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!c)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=c?c:null}({queryString:e,groupId:a});return[(0,h._X)(o),(0,c.useCallback)((function(n){if(o){var t=new URLSearchParams(r.location.search);t.set(o,n),r.replace(Object.assign({},r.location,{search:t.toString()}))}}),[o,r])]}function m(n){var t,e,a,r,i=n.defaultValue,h=n.queryString,s=void 0!==h&&h,u=n.groupId,m=p(n),v=(0,c.useState)((function(){return function(n){var t,e=n.defaultValue,c=n.tabValues;if(0===c.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!d({value:e,tabValues:c}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+e+'" but none of its children has the corresponding value. Available values are: '+c.map((function(n){return n.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return e}var a=null!=(t=c.find((function(n){return n.default})))?t:c[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:i,tabValues:m})})),f=v[0],x=v[1],b=g({queryString:s,groupId:u}),y=b[0],k=b[1],j=(t=function(n){return n?"docusaurus.tab."+n:null}({groupId:u}.groupId),e=(0,l.Nk)(t),a=e[0],r=e[1],[a,(0,c.useCallback)((function(n){t&&r.set(n)}),[t,r])]),_=j[0],T=j[1],N=function(){var n=null!=y?y:_;return d({value:n,tabValues:m})?n:null}();return(0,o.Z)((function(){N&&x(N)}),[N]),{selectedValue:f,selectValue:(0,c.useCallback)((function(n){if(!d({value:n,tabValues:m}))throw new Error("Can't select invalid tab value="+n);x(n),k(n),T(n)}),[k,T,m]),tabValues:m}}var v=e(72389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=e(85893);function b(n){var t=n.className,e=n.block,c=n.selectedValue,i=n.selectValue,o=n.tabValues,h=[],s=(0,r.o5)().blockElementScrollPositionUntilNextRender,l=function(n){var t=n.currentTarget,e=h.indexOf(t),a=o[e].value;a!==c&&(s(t),i(a))},u=function(n){var t,e=null;switch(n.key){case"Enter":l(n);break;case"ArrowRight":var c,a=h.indexOf(n.currentTarget)+1;e=null!=(c=h[a])?c:h[0];break;case"ArrowLeft":var r,i=h.indexOf(n.currentTarget)-1;e=null!=(r=h[i])?r:h[h.length-1]}null==(t=e)||t.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":e},t),children:o.map((function(n){var t=n.value,e=n.label,r=n.attributes;return(0,x.jsx)("li",Object.assign({role:"tab",tabIndex:c===t?0:-1,"aria-selected":c===t,ref:function(n){return h.push(n)},onKeyDown:u,onClick:l},r,{className:(0,a.Z)("tabs__item",f.tabItem,null==r?void 0:r.className,{"tabs__item--active":c===t}),children:null!=e?e:t}),t)}))})}function y(n){var t=n.lazy,e=n.children,a=n.selectedValue,r=(Array.isArray(e)?e:[e]).filter(Boolean);if(t){var i=r.find((function(n){return n.props.value===a}));return i?(0,c.cloneElement)(i,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map((function(n,t){return(0,c.cloneElement)(n,{key:t,hidden:n.props.value!==a})}))})}function k(n){var t=m(n);return(0,x.jsxs)("div",{className:(0,a.Z)("tabs-container",f.tabList),children:[(0,x.jsx)(b,Object.assign({},n,t)),(0,x.jsx)(y,Object.assign({},n,t))]})}function j(n){var t=(0,v.Z)();return(0,x.jsx)(k,Object.assign({},n,{children:u(n.children)}),String(t))}},77229:(n,t,e)=>{e.d(t,{Ey:()=>l,O2:()=>h,SQ:()=>s});e(67294);var c=e(74866),a=e(85162),r=e(95665),i=e.n(r),o=e(85893);function h(n){var t=n.children;return Array.isArray(t)||(t=[t]),(0,o.jsx)(c.Z,{className:"language-tabs",groupId:"code-tabs",children:t.map((function(n,t){return(0,o.jsx)(a.Z,{value:n.props.value,label:n.props.value,children:n})}))})}function s(n){var t=n.children,e=n.language;return Array.isArray(t)||(t=[t]),t=t.map((function(n){return function(n,t){var e=n.props,c=(e.children,e.url),a=e.start,r=e.end,i=e.fname;if(n.type===l)return l({url:c,start:a,end:r,language:t,fname:i});return n}(n,e)})),1==t.length?(0,o.jsx)(a.Z,{value:0,label:t[0].props.fname,children:t[0]}):(0,o.jsx)(c.Z,{className:"file-tabs",children:t.map((function(n,t){return(0,o.jsx)(a.Z,{value:t,label:n.props.fname,children:n})}))})}function l(n){var t=n.url,e=n.start,c=n.end,a=n.language,r=n.fname,h=t+"#";return e&&c&&(h+="L"+e+"-L"+c+"#"),(0,o.jsx)(i(),{language:a,fname:r,children:h})}}}]);